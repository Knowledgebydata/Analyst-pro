<!DOCTYPE html>
<!--
================================================================================
ZorgAnalyst Pro - Analysetool voor Zorgcriminaliteit en Zorgfraude Detectie
Versie: 1.0.0 TAURI DEMO | Licentie: Demo Organisatie - Demo Gebruiker
================================================================================

Copyright (c) 2025 L.P. Antenbrink, CEO/Founder Knowledge by Data. Alle rechten voorbehouden.

DEMO VERSIE - Voorgeladen met fictieve demonstratiedata
Zorgaanbieder: Zorggroep Horizon B.V. (fictief)

VERTROUWELIJK - UITSLUITEND VOOR DEMONSTRATIEDOELEINDEN
================================================================================
-->
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="author" content="L.P. Antenbrink, Knowledge by Data">
<meta name="copyright" content="Copyright (c) 2025 L.P. Antenbrink, Knowledge by Data">
<meta name="application-name" content="ZorgAnalyst Pro">
<meta name="version" content="1.0.0-TAURI-DEMO">
<title>ZorgAnalyst Pro DEMO - Knowledge by Data</title>
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-192x192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#009688">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<style>
:root{--primary:#0d6efd;--primary-dark:#0a58ca;--accent:#20c997;--accent-light:#63e6be;--success:#198754;--warning:#ffc107;--danger:#dc3545;--dark:#1a1a2e;--light:#f8f9fa;--gray:#6c757d;--kritiek:#dc3545;--hoog:#fd7e14;--gemiddeld:#ffc107}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--light);min-height:100vh}
.demo-banner{background:linear-gradient(90deg,#6f42c1,#0d6efd);color:white;padding:6px 15px;font-size:0.75rem;text-align:center;font-weight:600;position:fixed;top:0;left:0;right:0;z-index:1001}
.security-bar{background:var(--success);color:white;padding:8px 15px;font-size:0.8rem;text-align:center;position:fixed;top:28px;left:0;right:0;z-index:1000}
.auth-screen{min-height:calc(100vh - 64px);display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--dark),#16213e);margin-top:64px}
.auth-box{background:rgba(255,255,255,0.05);padding:40px;border-radius:16px;width:100%;max-width:400px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1)}
.auth-box h2{color:var(--accent);text-align:center;margin-bottom:20px}
.auth-box input{width:100%;padding:14px;margin-bottom:15px;border:2px solid rgba(255,255,255,0.1);border-radius:8px;background:rgba(0,0,0,0.3);color:white}
.auth-box input:focus{outline:none;border-color:var(--accent)}
.auth-box button{width:100%;padding:14px;background:var(--accent);color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer}
.auth-box button:hover{background:var(--accent-light)}
.auth-box .info{color:var(--gray);font-size:0.9rem;text-align:center;margin-top:15px}
#qrcode{display:flex;justify-content:center;margin:20px 0;background:white;padding:15px;border-radius:8px}
.hidden{display:none!important}
.app-container{display:flex;min-height:calc(100vh - 64px);margin-top:64px}
.sidebar{width:280px;background:var(--dark);color:white;padding:20px;display:flex;flex-direction:column;position:fixed;top:64px;left:0;bottom:0;overflow-y:auto;z-index:100}
.sidebar-header h1{font-size:1.1rem;color:var(--accent)}
.sidebar-header p{color:var(--gray);font-size:0.75rem;margin-top:5px}
.nav-item{padding:12px 15px;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:12px;margin-bottom:5px;transition:all 0.2s}
.nav-item:hover,.nav-item.active{background:rgba(32,201,151,0.2);color:var(--accent)}
.nav-item i{width:20px}
.sidebar-footer{margin-top:auto;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1)}
.sidebar-footer p{font-size:0.7rem;color:var(--gray)}
.main-content{flex:1;padding:30px;overflow-y:auto;margin-left:280px}
.page{display:none}.page.active{display:block}
.page-header h2{font-size:1.6rem;color:var(--dark);margin-bottom:5px}
.page-header p{color:var(--gray)}
.card{background:white;border-radius:12px;padding:25px;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.card h3{color:var(--dark);margin-bottom:15px}
.card h3 i{color:var(--accent);margin-right:10px}
.btn{padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all 0.2s}
.btn-primary{background:var(--primary);color:white}
.btn-primary:hover{background:var(--primary-dark)}
.btn-accent{background:var(--accent);color:white}
.btn-danger{background:var(--danger);color:white}
.upload-zone{border:3px dashed #ddd;border-radius:16px;padding:60px;text-align:center;cursor:pointer;transition:all 0.3s}
.upload-zone:hover{border-color:var(--accent);background:rgba(32,201,151,0.05)}
.upload-zone i{font-size:4rem;color:var(--accent);margin-bottom:20px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px}
.stat-card{background:white;border-radius:12px;padding:15px;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.stat-card h4{font-size:0.8rem;color:var(--gray)}
.stat-card .value{font-size:1.4rem;font-weight:700;color:var(--dark)}
.red-flag{background:rgba(220,53,69,0.05);border-left:4px solid var(--danger);padding:15px;margin-bottom:15px;border-radius:0 8px 8px 0}
.red-flag h4{color:var(--danger);margin-bottom:8px}
.red-flag p{color:var(--gray);font-size:0.9rem}
.red-flag.hoog{border-left-color:var(--hoog);background:rgba(253,126,20,0.05)}
.red-flag.hoog h4{color:var(--hoog)}
.red-flag.gemiddeld{border-left-color:var(--gemiddeld);background:rgba(255,193,7,0.05)}
.red-flag.gemiddeld h4{color:#997404}
#graphContainer{width:100%;height:450px;background:#fafafa;border-radius:8px}
.node circle{stroke:#fff;stroke-width:2px;cursor:pointer}
.node text{font-size:10px;fill:#333}
.link{stroke:#999;stroke-opacity:0.6}
.source-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.source-item{display:flex;align-items:center;gap:12px;padding:12px;background:#f8f9fa;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.source-item:hover{border-color:var(--accent)}
.source-icon{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.source-info strong{display:block;font-size:0.9rem}
.source-info span{font-size:0.75rem;color:var(--gray)}
.log-entry{display:flex;gap:15px;padding:12px 0;border-bottom:1px solid #eee}
.log-entry:last-child{border-bottom:none}
.log-time{min-width:140px;font-size:0.8rem;color:var(--gray);font-family:monospace}
.log-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:0.9rem}
.log-icon.action{background:rgba(13,110,253,0.1);color:var(--primary)}
.log-icon.note{background:rgba(32,201,151,0.1);color:var(--accent)}
.log-icon.alert{background:rgba(220,53,69,0.1);color:var(--danger)}
.log-icon.success{background:rgba(25,135,84,0.1);color:var(--success)}
.log-content{flex:1}
.log-content strong{display:block;color:var(--dark);margin-bottom:2px}
.log-content p{color:var(--gray);font-size:0.9rem;margin:0}
.note-input{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:1rem;resize:vertical;min-height:80px;font-family:inherit}
.note-input:focus{outline:none;border-color:var(--accent)}
.upload-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.upload-box{border:3px dashed #ddd;border-radius:12px;padding:30px;text-align:center;cursor:pointer;transition:all 0.3s}
.upload-box:hover{border-color:var(--accent);background:rgba(32,201,151,0.05)}
.upload-box i{font-size:2.5rem;margin-bottom:15px}
.upload-box h4{margin-bottom:5px;color:var(--dark)}
.upload-box p{font-size:0.8rem;color:var(--gray);margin:0}
.uploaded-files{margin-top:20px}
.uploaded-file{display:flex;align-items:center;gap:12px;padding:12px;background:#f8f9fa;border-radius:8px;margin-bottom:8px}
.uploaded-file i{font-size:1.5rem}
.uploaded-file .file-info{flex:1}
.uploaded-file .file-info strong{display:block;font-size:0.9rem}
.uploaded-file .file-info span{font-size:0.8rem;color:var(--gray)}
.uploaded-file .file-status{padding:4px 10px;border-radius:12px;font-size:0.75rem;font-weight:600}
.uploaded-file .file-status.success{background:rgba(25,135,84,0.1);color:var(--success)}
.indicator-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:0.7rem;font-weight:600;margin-left:8px}
.indicator-badge.kritiek{background:var(--kritiek);color:white}
.indicator-badge.hoog{background:var(--hoog);color:white}
.indicator-badge.gemiddeld{background:var(--gemiddeld);color:#000}
.category-tag{display:inline-block;padding:3px 10px;border-radius:12px;font-size:0.75rem;font-weight:500;margin-right:5px}
.category-tag.zorg{background:rgba(32,201,151,0.15);color:var(--accent)}
.category-tag.toezicht{background:rgba(13,110,253,0.15);color:var(--primary)}
.category-tag.financieel{background:rgba(255,193,7,0.15);color:#997404}
.category-tag.structuur{background:rgba(111,66,193,0.15);color:#6f42c1}
.category-tag.documentatie{background:rgba(108,117,125,0.15);color:var(--gray)}
.risico-meter{height:24px;background:#e9ecef;border-radius:12px;overflow:hidden;margin:10px 0}
.risico-meter .fill{height:100%;transition:width 0.5s ease}
.risico-meter .fill.laag{background:linear-gradient(90deg,#198754,#20c997)}
.risico-meter .fill.gemiddeld{background:linear-gradient(90deg,#ffc107,#fd7e14)}
.risico-meter .fill.hoog{background:linear-gradient(90deg,#fd7e14,#dc3545)}
.risico-meter .fill.kritiek{background:linear-gradient(90deg,#dc3545,#842029)}
.checklist-item{display:flex;align-items:center;gap:12px;padding:12px 15px;margin-bottom:8px;background:#f8f9fa;border-radius:8px;cursor:pointer;transition:all 0.2s}
.checklist-item:hover{background:#e9ecef}
.checklist-item.checked{background:#d1e7dd}
.entity-card{background:#f8f9fa;border-radius:10px;padding:15px;margin-bottom:12px;border-left:4px solid var(--accent)}
.entity-card h4{margin-bottom:8px;color:var(--dark)}
.entity-card p{font-size:0.85rem;color:var(--gray);margin:3px 0}
.entity-card .badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:0.7rem;background:var(--primary);color:white;margin-right:5px}
</style>
</head>
<body>
<!-- Demo Banner -->
<div class="demo-banner">
<i class="fas fa-flask"></i> DEMONSTRATIE VERSIE - Voorgeladen met fictieve data van "Zorggroep Horizon B.V." - PIN: 123456
</div>
<!-- Security Bar -->
<div class="security-bar">
<i class="fas fa-shield-alt"></i> ZorgAnalyst Pro v1.0.0 DEMO | <span id="licenseInfo">Verificatie...</span> | <i class="fas fa-lock"></i> Lokale verwerking
</div>
<!-- Auth Screen -->
<div id="authScreen" class="auth-screen">
<div class="auth-box">
<h2><i class="fas fa-heartbeat"></i> ZorgAnalyst Pro</h2>
<p style="color:#aaa;text-align:center;margin-bottom:25px;font-size:0.9rem">Zorgcriminaliteit & Fraude Detectie Tool</p>
<div style="background:rgba(111,66,193,0.2);padding:12px;border-radius:8px;margin-bottom:20px;text-align:center">
<p style="color:#b794f6;font-size:0.85rem"><i class="fas fa-info-circle"></i> Demo PIN: <strong style="color:white">123456</strong></p>
</div>
<div id="qrcode"></div>
<input type="password" id="pinInput" placeholder="Voer uw PIN in" maxlength="6" autocomplete="off" value="123456">
<button onclick="Auth.verify()"><i class="fas fa-sign-in-alt"></i> Inloggen</button>
<p class="info" id="attemptsInfo">Pogingen: 3 resterend</p>
<p class="info" style="margin-top:20px;font-size:0.75rem;color:#666">Ã‚Â© 2025 Knowledge by Data B.V.</p>
</div>
</div>
<!-- Main App -->
<div id="appContainer" class="app-container hidden">
<div class="sidebar">
<div class="sidebar-header">
<h1><i class="fas fa-heartbeat"></i> ZorgAnalyst Pro</h1>
<p>Zorgcriminaliteit Detectie v1.0.0 DEMO</p>
</div>
<nav style="margin-top:30px">
<div class="nav-item active" onclick="App.showPage('dashboard')"><i class="fas fa-home"></i> Dashboard</div>
<div class="nav-item" onclick="App.showPage('graph')"><i class="fas fa-project-diagram"></i> Structuur</div>
<div class="nav-item" onclick="App.showPage('timeline')"><i class="fas fa-clock"></i> Tijdlijn</div>
<div class="nav-item" onclick="App.showPage('sources')"><i class="fas fa-database"></i> Bronnen</div>
<div class="nav-item" onclick="App.showPage('declaraties')"><i class="fas fa-file-invoice-dollar"></i> Declaraties</div>
<div class="nav-item" onclick="App.showPage('redflags')"><i class="fas fa-flag"></i> Signalen <span style="background:var(--danger);color:white;padding:2px 6px;border-radius:10px;font-size:0.7rem;margin-left:5px">8</span></div>
<div class="nav-item" onclick="App.showPage('interview')"><i class="fas fa-comments"></i> Interview</div>
<div class="nav-item" onclick="App.showPage('rapport')"><i class="fas fa-file-alt"></i> Rapport</div>
<div class="nav-item" onclick="App.showPage('settings')"><i class="fas fa-cog"></i> Instellingen</div>
</nav>
<div class="sidebar-footer">
<p><i class="fas fa-user"></i> <span id="userDisplay">Demo Gebruiker</span></p>
<p><i class="fas fa-building"></i> <span id="orgDisplay">Demo Organisatie</span></p>
<p style="margin-top:10px"><i class="fas fa-hdd"></i> Lokale opslag</p>
</div>
</div>
<div class="main-content">
<!-- DASHBOARD PAGE -->
<div id="page-dashboard" class="page active">
<div class="page-header">
<h2><i class="fas fa-heartbeat" style="color:var(--accent)"></i> Zorgfraude Analyse Dashboard</h2>
<p>Integriteitsonderzoek en screening van zorgaanbieders</p>
</div>
<!-- Dossier Info -->
<div class="card" style="background:linear-gradient(135deg,#0d6efd,#0a58ca);color:white;margin-bottom:20px">
<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px">
<div>
<h3 style="color:white;margin-bottom:10px"><i class="fas fa-folder-open" style="color:var(--accent)"></i> Huidig Dossier</h3>
<p style="font-size:1.1rem;margin-bottom:5px">Dossiernummer: <strong id="dossierCode">ZA-2025-0847</strong></p>
<p style="font-size:0.85rem;opacity:0.8" id="dossierMeta">Wmo-toezicht | Zorggroep Horizon B.V. | Gestart: 15-01-2025</p>
</div>
<div style="display:flex;gap:10px;flex-wrap:wrap">
<button class="btn" style="background:var(--accent);color:white" onclick="OnderzoekInit.showDialog()"><i class="fas fa-plus"></i> Nieuw</button>
<button class="btn" style="background:rgba(255,255,255,0.2);color:white" onclick="Dossier.load()"><i class="fas fa-folder-open"></i> Openen</button>
<button class="btn" style="background:rgba(255,255,255,0.2);color:white" onclick="Dossier.save()"><i class="fas fa-save"></i> Opslaan</button>
<button class="btn" style="background:#6f42c1;color:white" onclick="DemoData.reload()"><i class="fas fa-flask"></i> Demo Laden</button>
</div>
</div>
</div>
<!-- Stats -->
<div class="stats-grid">
<div class="stat-card"><h4><i class="fas fa-building"></i> Zorgaanbieders</h4><div class="value" id="statCompanies">4</div></div>
<div class="stat-card"><h4><i class="fas fa-users"></i> Betrokkenen</h4><div class="value" id="statPersons">8</div></div>
<div class="stat-card"><h4><i class="fas fa-link"></i> Relaties</h4><div class="value" id="statRelations">16</div></div>
<div class="stat-card" style="border-left:3px solid var(--danger)"><h4><i class="fas fa-flag"></i> Signalen</h4><div class="value" id="statFlags" style="color:var(--danger)">8</div></div>
<div class="stat-card"><h4><i class="fas fa-file-pdf"></i> Documenten</h4><div class="value" id="statDocs">6</div></div>
</div>
<!-- Upload Section -->
<div class="card">
<h3><i class="fas fa-upload"></i> Document Upload</h3>
<p style="color:var(--gray);margin-bottom:20px">Upload PDF-documenten voor automatische analyse</p>
<div class="upload-grid">
<div class="upload-box" style="border-color:#0066cc" onclick="document.getElementById('kvkInput').click()">
<i class="fas fa-building" style="color:#0066cc"></i>
<h4>KvK Uittreksel</h4>
<p>Handelsregister</p>
<input type="file" id="kvkInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'kvk')">
</div>
<div class="upload-box" style="border-color:#9b59b6" onclick="document.getElementById('creditsafeInput').click()">
<i class="fas fa-chart-line" style="color:#9b59b6"></i>
<h4>CreditSafe / Graydon</h4>
<p>Kredietrapportage</p>
<input type="file" id="creditsafeInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'creditsafe')">
</div>
<div class="upload-box" style="border-color:var(--success)" onclick="document.getElementById('jaarverslagInput').click()">
<i class="fas fa-book" style="color:var(--success)"></i>
<h4>Jaarverslag</h4>
<p>Jaarrekening</p>
<input type="file" id="jaarverslagInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'jaarverslag')">
</div>
<div class="upload-box" style="border-color:var(--accent)" onclick="document.getElementById('zorgplanInput').click()">
<i class="fas fa-clipboard-list" style="color:var(--accent)"></i>
<h4>Zorgplan / Aanvraag</h4>
<p>Wmo/PGB aanvraag</p>
<input type="file" id="zorgplanInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'zorgplan')">
</div>
<div class="upload-box" style="border-color:var(--primary)" onclick="document.getElementById('declaratieInput').click()">
<i class="fas fa-file-invoice-dollar" style="color:var(--primary)"></i>
<h4>Declaraties</h4>
<p>PGB verantwoording</p>
<input type="file" id="declaratieInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'declaratie')">
</div>
<div class="upload-box" style="border-color:var(--danger)" onclick="document.getElementById('igjInput').click()">
<i class="fas fa-stethoscope" style="color:var(--danger)"></i>
<h4>IGJ Rapport</h4>
<p>Inspectie</p>
<input type="file" id="igjInput" accept=".pdf" style="display:none" onchange="PDFHandler.handleUpload(this,'igj')">
</div>
</div>
<div id="uploadedFilesList" class="uploaded-files"></div>
</div>
<!-- Risk Overview -->
<div class="card">
<h3><i class="fas fa-tachometer-alt"></i> Risicoprofiel</h3>
<div style="display:grid;grid-template-columns:200px 1fr;gap:30px;align-items:center;margin-top:20px">
<div style="text-align:center">
<div id="riskScoreDisplay" style="width:150px;height:150px;border-radius:50%;background:conic-gradient(var(--danger) 230deg,#e9ecef 230deg);display:flex;align-items:center;justify-content:center;margin:0 auto">
<div style="width:120px;height:120px;border-radius:50%;background:white;display:flex;flex-direction:column;align-items:center;justify-content:center">
<span id="riskScore" style="font-size:2.5rem;font-weight:700;color:var(--danger)">64</span>
<span style="font-size:0.8rem;color:var(--gray)">Risicoscore</span>
</div>
</div>
<p id="riskLabel" style="margin-top:15px;font-weight:600;color:var(--danger)">Hoog Risico</p>
</div>
<div>
<h4 style="margin-bottom:15px">Score per Categorie</h4>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
<div><div style="display:flex;justify-content:space-between"><span><i class="fas fa-heartbeat" style="color:var(--accent)"></i> Zorg</span><span id="catZorg" style="font-weight:700;color:var(--danger)">70</span></div><div class="risico-meter"><div id="barZorg" class="fill hoog" style="width:70%"></div></div></div>
<div><div style="display:flex;justify-content:space-between"><span><i class="fas fa-euro-sign" style="color:var(--warning)"></i> Financieel</span><span id="catFinancieel" style="font-weight:700;color:var(--hoog)">60</span></div><div class="risico-meter"><div id="barFinancieel" class="fill hoog" style="width:60%"></div></div></div>
<div><div style="display:flex;justify-content:space-between"><span><i class="fas fa-sitemap" style="color:#6f42c1"></i> Structuur</span><span id="catStructuur" style="font-weight:700;color:var(--hoog)">80</span></div><div class="risico-meter"><div id="barStructuur" class="fill kritiek" style="width:80%"></div></div></div>
<div><div style="display:flex;justify-content:space-between"><span><i class="fas fa-eye" style="color:var(--primary)"></i> Toezicht</span><span id="catToezicht" style="font-weight:700;color:var(--warning)">40</span></div><div class="risico-meter"><div id="barToezicht" class="fill gemiddeld" style="width:40%"></div></div></div>
</div>
<button class="btn btn-primary" style="margin-top:20px" onclick="Overview.recalculateScore()"><i class="fas fa-calculator"></i> Herbereken Score</button>
</div>
</div>
</div>
<!-- Structure Info -->
<div class="card">
<h3><i class="fas fa-building"></i> Zorgaanbieder Informatie</h3>
<div id="structureInfo">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
<div class="entity-card" style="border-left-color:var(--danger)">
<h4><i class="fas fa-building" style="color:var(--danger)"></i> Zorggroep Horizon B.V.</h4>
<p><strong>KvK:</strong> 87654321</p>
<p><strong>Rechtsvorm:</strong> B.V.</p>
<p><strong>Oprichting:</strong> 12-03-2019</p>
<p><strong>Activiteit:</strong> Wmo-ondersteuning, PGB-zorg, Dagbesteding</p>
<span class="badge" style="background:var(--danger)">Hoofdonderwerp</span>
</div>
<div class="entity-card">
<h4><i class="fas fa-building"></i> Horizon Vastgoed B.V.</h4>
<p><strong>KvK:</strong> 87654322</p>
<p><strong>Rechtsvorm:</strong> B.V.</p>
<p><strong>Oprichting:</strong> 15-06-2018</p>
<p><strong>Activiteit:</strong> Verhuur bedrijfspanden</p>
<span class="badge" style="background:var(--warning);color:#000">Nevenbedrijf</span>
</div>
<div class="entity-card">
<h4><i class="fas fa-building"></i> HZN Holding B.V.</h4>
<p><strong>KvK:</strong> 87654320</p>
<p><strong>Rechtsvorm:</strong> B.V.</p>
<p><strong>Oprichting:</strong> 01-01-2017</p>
<p><strong>Activiteit:</strong> Houdstermaatschappij</p>
<span class="badge" style="background:#6f42c1">Holding</span>
</div>
<div class="entity-card">
<h4><i class="fas fa-building"></i> CleanCare Services B.V.</h4>
<p><strong>KvK:</strong> 87654323</p>
<p><strong>Rechtsvorm:</strong> B.V.</p>
<p><strong>Oprichting:</strong> 20-09-2020</p>
<p><strong>Activiteit:</strong> Schoonmaakdiensten</p>
<span class="badge" style="background:var(--warning);color:#000">Nevenbedrijf</span>
</div>
</div>
</div>
</div>
</div>
<!-- GRAPH PAGE -->
<div id="page-graph" class="page">
<div class="page-header"><h2>Organisatie Structuur</h2><p>Relatienetwerk van zorgaanbieders en betrokkenen</p></div>
<div style="display:grid;grid-template-columns:260px 1fr;gap:20px;height:calc(100vh - 200px)">
<div class="card" style="display:flex;flex-direction:column;overflow:hidden">
<h4 style="margin-bottom:8px"><i class="fas fa-filter" style="color:var(--accent)"></i> Entiteiten</h4>
<div style="display:flex;gap:6px;margin-bottom:10px">
<button class="btn" style="flex:1;padding:6px;font-size:0.75rem;background:var(--success);color:white" onclick="Graph.selectAll()"><i class="fas fa-check-double"></i> Alles</button>
<button class="btn" style="flex:1;padding:6px;font-size:0.75rem;background:var(--gray);color:white" onclick="Graph.selectNone()"><i class="fas fa-times"></i> Geen</button>
</div>
<div id="graphFilter" style="flex:1;overflow-y:auto"></div>
</div>
<div class="card" style="display:flex;flex-direction:column;overflow:hidden">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
<h3 style="margin:0"><i class="fas fa-project-diagram"></i> Relatienetwerk</h3>
<div style="display:flex;gap:5px">
<button onclick="Graph.zoomIn()" style="width:32px;height:32px;border:1px solid #ddd;border-radius:4px;background:white;cursor:pointer"><i class="fas fa-search-plus"></i></button>
<button onclick="Graph.zoomOut()" style="width:32px;height:32px;border:1px solid #ddd;border-radius:4px;background:white;cursor:pointer"><i class="fas fa-search-minus"></i></button>
<button onclick="Graph.zoomReset()" style="width:32px;height:32px;border:1px solid #ddd;border-radius:4px;background:white;cursor:pointer"><i class="fas fa-compress-arrows-alt"></i></button>
</div>
</div>
<div id="graphContainer" style="flex:1;min-height:0"></div>
<div style="margin-top:10px;font-size:0.8rem;display:flex;flex-wrap:wrap;gap:12px">
<span><i class="fas fa-square" style="color:var(--accent)"></i> Zorgaanbieder</span>
<span><i class="fas fa-square" style="color:#6f42c1"></i> Holding</span>
<span><i class="fas fa-circle" style="color:var(--success)"></i> Bestuurder</span>
<span><i class="fas fa-circle" style="color:var(--danger)"></i> UBO</span>
<span><i class="fas fa-circle" style="color:var(--warning)"></i> Aandeelhouder</span>
</div>
</div>
</div>
</div>
<!-- TIMELINE PAGE -->
<div id="page-timeline" class="page">
<div class="page-header"><h2>Tijdlijn</h2><p>Chronologisch overzicht van inschrijvingen, mutaties en gebeurtenissen</p></div>
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px">
<h3 style="margin:0"><i class="fas fa-stream"></i> Chronologische Tijdlijn</h3>
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button class="btn" style="padding:6px 12px;font-size:0.8rem;background:var(--accent);color:white" onclick="Timeline.filter('all')"><i class="fas fa-list"></i> Alles</button>
<button class="btn" style="padding:6px 12px;font-size:0.8rem;background:rgba(0,102,204,0.15);color:#0066cc" onclick="Timeline.filter('inschrijving')"><i class="fas fa-building"></i> Inschrijvingen</button>
<button class="btn" style="padding:6px 12px;font-size:0.8rem;background:rgba(25,135,84,0.15);color:var(--success)" onclick="Timeline.filter('bestuurder')"><i class="fas fa-user-tie"></i> Bestuurders</button>
<button class="btn" style="padding:6px 12px;font-size:0.8rem;background:rgba(111,66,193,0.15);color:#6f42c1" onclick="Timeline.filter('aandeelhouder')"><i class="fas fa-hand-holding-usd"></i> Aandeelhouders</button>
<button class="btn" style="padding:6px 12px;font-size:0.8rem;background:rgba(220,53,69,0.15);color:var(--danger)" onclick="Timeline.filter('signaal')"><i class="fas fa-flag"></i> Signalen</button>
</div>
</div>
<div id="timelineContainer" style="max-height:500px;overflow-y:auto"></div>
</div>
<div class="card">
<h3><i class="fas fa-random"></i> Cross-Reference Analyse</h3>
<p style="color:var(--gray);margin-bottom:20px">Gedetecteerde verbanden en overlap tussen entiteiten</p>
<div id="crossReferenceContainer"></div>
</div>
<div class="card">
<h3><i class="fas fa-exchange-alt"></i> Bestuurderswisselingen</h3>
<p style="color:var(--gray);margin-bottom:15px">Overzicht van mutaties in bestuur en aandeelhouderschap</p>
<div id="mutationsContainer"></div>
</div>
</div>
<!-- SOURCES PAGE -->
<div id="page-sources" class="page">
<div class="page-header"><h2>Bronnen & Registers</h2><p>Raadpleeg externe bronnen voor verificatie</p></div>
<div class="card">
<h3><i class="fas fa-globe"></i> Open Bronnen</h3>
<p style="color:var(--gray);margin-bottom:20px">Klik om externe bronnen te openen</p>
<div class="source-grid">
<div class="source-item" onclick="Sources.open('kvk')"><div class="source-icon" style="background:rgba(0,102,204,0.1)"><i class="fas fa-building" style="color:#0066cc"></i></div><div class="source-info"><strong>KvK Handelsregister</strong><span>Bedrijfsinformatie</span></div></div>
<div class="source-item" onclick="Sources.open('skj')"><div class="source-icon" style="background:rgba(32,201,151,0.1)"><i class="fas fa-user-check" style="color:var(--accent)"></i></div><div class="source-info"><strong>SKJ Register</strong><span>Jeugdzorg professionals</span></div></div>
<div class="source-item" onclick="Sources.open('big')"><div class="source-icon" style="background:rgba(220,53,69,0.1)"><i class="fas fa-stethoscope" style="color:var(--danger)"></i></div><div class="source-info"><strong>BIG Register</strong><span>Zorgprofessionals</span></div></div>
<div class="source-item" onclick="Sources.open('igj')"><div class="source-icon" style="background:rgba(13,110,253,0.1)"><i class="fas fa-hospital" style="color:var(--primary)"></i></div><div class="source-info"><strong>IGJ Rapporten</strong><span>Inspectie Gezondheidszorg</span></div></div>
<div class="source-item" onclick="Sources.open('nza')"><div class="source-icon" style="background:rgba(25,135,84,0.1)"><i class="fas fa-clipboard-list" style="color:var(--success)"></i></div><div class="source-info"><strong>NZa</strong><span>Nederlandse Zorgautoriteit</span></div></div>
<div class="source-item" onclick="Sources.open('ikz')"><div class="source-icon" style="background:rgba(220,53,69,0.1)"><i class="fas fa-user-secret" style="color:var(--danger)"></i></div><div class="source-info"><strong>IKZ</strong><span>Knooppunt Zorgfraude</span></div></div>
</div>
</div>
<div class="card">
<h3><i class="fas fa-history"></i> Activiteitenlog</h3>
<div id="activityLog" style="max-height:400px;overflow-y:auto"></div>
<div style="margin-top:15px"><textarea id="noteInput" class="note-input" placeholder="Voeg een aantekening toe..."></textarea></div>
<button class="btn btn-accent" style="margin-top:10px" onclick="ActivityLog.addNote()"><i class="fas fa-sticky-note"></i> Toevoegen</button>
</div>
</div>
<!-- DECLARATIES PAGE -->
<div id="page-declaraties" class="page">
<div class="page-header"><h2>Declaratie Analyse</h2><p>Analyse van PGB-verantwoordingen en zorgdeclaraties</p></div>
<div class="card">
<h3><i class="fas fa-chart-bar"></i> Demo Declaratie Overzicht</h3>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px">
<div class="stat-card"><h4>Totaal gedeclareerd</h4><div class="value" style="color:var(--primary)">Ã¢â€šÂ¬ 487.250</div></div>
<div class="stat-card"><h4>Aantal declaraties</h4><div class="value">156</div></div>
<div class="stat-card"><h4>Verdachte patronen</h4><div class="value" style="color:var(--danger)">12</div></div>
<div class="stat-card"><h4>Gemiddeld per maand</h4><div class="value">Ã¢â€šÂ¬ 40.604</div></div>
</div>
</div>
<div class="card">
<h3><i class="fas fa-search-dollar"></i> Gedetecteerde Declaratie Signalen</h3>
<div id="declaratieSignalen">
<div class="red-flag kritiek">
<h4><i class="fas fa-exclamation-triangle"></i> Onmogelijke uren gedetecteerd</h4>
<p>Op 14 dagen zijn meer dan 16 uur per dag gedeclareerd voor dezelfde cliÃƒÂ«nt. Maximum op 23-11-2024: 22 uur.</p>
</div>
<div class="red-flag hoog">
<h4><i class="fas fa-exclamation-triangle"></i> Dubbele declaraties</h4>
<p>3 declaraties zijn dubbel ingediend voor dezelfde datum en cliÃƒÂ«nt (totaal Ã¢â€šÂ¬4.350).</p>
</div>
<div class="red-flag hoog">
<h4><i class="fas fa-exclamation-triangle"></i> Weekend/feestdag declaraties</h4>
<p>47% van alle declaraties betreft weekenden en feestdagen - significant hoger dan sectorgemiddelde (18%).</p>
</div>
<div class="red-flag gemiddeld">
<h4><i class="fas fa-exclamation-triangle"></i> Tarief boven maximum</h4>
<p>Gehanteerd uurtarief (Ã¢â€šÂ¬68,-) ligt 23% boven het gemeentelijk maximumtarief (Ã¢â€šÂ¬55,-).</p>
</div>
</div>
</div>
<div class="card">
<h3><i class="fas fa-file-invoice-dollar"></i> Extra Declaratie Upload</h3>
<div class="upload-zone" onclick="document.getElementById('declaratieUploadMain').click()">
<i class="fas fa-file-invoice-dollar"></i>
<h3>Sleep declaratiedocumenten hierheen</h3>
<p style="color:var(--gray)">Of klik om bestanden te selecteren (PDF)</p>
<input type="file" id="declaratieUploadMain" accept=".pdf" style="display:none" onchange="DeclaratieAnalyse.handleUpload(this)" multiple>
</div>
</div>
</div>
<!-- RED FLAGS PAGE -->
<div id="page-redflags" class="page">
<div class="page-header"><h2>Signalen & Indicatoren</h2><p>Gedetecteerde risico-indicatoren voor zorgfraude</p></div>
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
<h3 style="margin:0"><i class="fas fa-flag"></i> Actieve Signalen (<span id="flagCount">8</span>)</h3>
<div style="display:flex;gap:10px">
<select id="flagFilter" onchange="RedFlagsManager.render()" style="padding:8px;border:1px solid #ddd;border-radius:6px">
<option value="all">Alle categorieÃƒÂ«n</option>
<option value="zorg">Zorg (ZOR)</option>
<option value="toezicht">Toezicht (TOE)</option>
<option value="financieel">Financieel (FIN)</option>
<option value="structuur">Structuur (STR)</option>
<option value="documentatie">Documentatie (DOC)</option>
</select>
<select id="severityFilter" onchange="RedFlagsManager.render()" style="padding:8px;border:1px solid #ddd;border-radius:6px">
<option value="all">Alle ernst</option>
<option value="kritiek">Kritiek</option>
<option value="hoog">Hoog</option>
<option value="gemiddeld">Gemiddeld</option>
</select>
</div>
</div>
<div id="redFlagsList"></div>
</div>
<div class="card">
<h3><i class="fas fa-book"></i> Indicatoren Bibliotheek (43 indicatoren)</h3>
<div style="display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap">
<button class="btn" style="padding:8px 16px;font-size:0.85rem" onclick="IndicatorenBibliotheek.show('all')"><i class="fas fa-list"></i> Alle</button>
<button class="btn" style="padding:8px 16px;font-size:0.85rem;background:rgba(32,201,151,0.15);color:var(--accent)" onclick="IndicatorenBibliotheek.show('zorg')"><i class="fas fa-heartbeat"></i> Zorg (16)</button>
<button class="btn" style="padding:8px 16px;font-size:0.85rem;background:rgba(13,110,253,0.15);color:var(--primary)" onclick="IndicatorenBibliotheek.show('toezicht')"><i class="fas fa-eye"></i> Toezicht (11)</button>
<button class="btn" style="padding:8px 16px;font-size:0.85rem;background:rgba(255,193,7,0.15);color:#997404" onclick="IndicatorenBibliotheek.show('financieel')"><i class="fas fa-euro-sign"></i> Financieel (6)</button>
<button class="btn" style="padding:8px 16px;font-size:0.85rem;background:rgba(111,66,193,0.15);color:#6f42c1" onclick="IndicatorenBibliotheek.show('structuur')"><i class="fas fa-sitemap"></i> Structuur (5)</button>
<button class="btn" style="padding:8px 16px;font-size:0.85rem;background:rgba(108,117,125,0.15);color:var(--gray)" onclick="IndicatorenBibliotheek.show('documentatie')"><i class="fas fa-file-alt"></i> Documentatie (5)</button>
</div>
<div id="indicatorenBibliotheek" style="max-height:400px;overflow-y:auto"></div>
</div>
</div>
<!-- INTERVIEW PAGE -->
<div id="page-interview" class="page">
<div class="page-header"><h2>Interview & Verificatie</h2><p>Genereer interviewvragen op basis van signalen</p></div>
<div class="card">
<h3><i class="fas fa-clipboard-list"></i> Interview Voorbereiding</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px">
<div><label style="display:block;margin-bottom:8px;font-weight:600">Type onderzoek</label>
<select id="interviewType" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
<option value="wmo" selected>Wmo-toezicht</option><option value="pgb">PGB-controle</option><option value="jeugd">Jeugdzorg</option><option value="wlz">Wlz-controle</option><option value="integriteit">Integriteitsonderzoek</option>
</select></div>
<div><label style="display:block;margin-bottom:8px;font-weight:600">GeÃƒÂ¯nterviewde</label>
<select id="interviewTarget" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
<option value="">Selecteer betrokkene...</option>
<option value="jansen">R.J. Jansen (Bestuurder)</option>
<option value="devries">M.A. de Vries (Bestuurder)</option>
<option value="bakker">P.H. Bakker (Aandeelhouder/UBO)</option>
</select></div>
</div>
<button class="btn btn-accent" style="margin-top:20px" onclick="InterviewModule.generate()"><i class="fas fa-magic"></i> Genereer Vragen</button>
</div>
<div class="card">
<h3><i class="fas fa-comments"></i> Gegenereerde Vragen</h3>
<div id="interviewPreview" style="display:none;background:#f8f9fa;padding:20px;border-radius:8px;margin-top:15px"></div>
<div id="interviewEmpty" style="text-align:center;padding:40px;color:var(--gray)"><i class="fas fa-comment-dots" style="font-size:3rem;margin-bottom:15px;display:block"></i><p>Klik op "Genereer Vragen" voor 8 vragen gebaseerd op gedetecteerde signalen</p></div>
</div>
<div class="card"><h3><i class="fas fa-download"></i> Export</h3><button class="btn btn-primary" onclick="InterviewModule.downloadWord()" id="btnDownloadInterview" disabled><i class="fas fa-file-word"></i> Download Word</button></div>
</div>
<!-- RAPPORT PAGE -->
<div id="page-rapport" class="page">
<div class="page-header"><h2>Rapportage</h2><p>Genereer onderzoeksrapport en advies</p></div>
<div class="card">
<h3><i class="fas fa-file-alt"></i> Rapport Configuratie</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px">
<div><label style="display:block;margin-bottom:8px;font-weight:600">Rapport type</label>
<select id="rapportType" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
<option value="signalering">Signaleringsrapport</option><option value="advies">Adviesrapport</option><option value="volledig" selected>Volledig Onderzoeksrapport</option>
</select></div>
<div><label style="display:block;margin-bottom:8px;font-weight:600">Advies</label>
<select id="adviceType" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px">
<option value="">Selecteer advies...</option><option value="positief">Positief - Geen bezwaren</option><option value="voorwaardelijk">Voorwaardelijk</option><option value="negatief" selected>Negatief - Ernstige signalen</option><option value="nader">Nader onderzoek nodig</option>
</select></div>
</div>
<div style="margin-top:20px">
<label style="display:flex;align-items:center;gap:10px;cursor:pointer"><input type="checkbox" id="optIncludeSignalen" checked style="width:18px;height:18px"><span>Inclusief 8 signalen</span></label>
<label style="display:flex;align-items:center;gap:10px;cursor:pointer;margin-top:10px"><input type="checkbox" id="optIncludeBronnen" checked style="width:18px;height:18px"><span>Inclusief 6 bronnen</span></label>
</div>
<button class="btn btn-accent" style="margin-top:20px" onclick="RapportGenerator.generate()"><i class="fas fa-file-alt"></i> Genereer Rapport</button>
</div>
<div class="card">
<h3><i class="fas fa-eye"></i> Rapport Preview</h3>
<div id="rapportPreview" style="display:none;background:#fff;padding:30px;border:1px solid #ddd;border-radius:8px;margin-top:15px;max-height:600px;overflow-y:auto"></div>
<div id="rapportEmpty" style="text-align:center;padding:40px;color:var(--gray)"><i class="fas fa-file-alt" style="font-size:3rem;margin-bottom:15px;display:block"></i><p>Klik op "Genereer Rapport" voor volledig onderzoeksrapport</p></div>
</div>
<div class="card">
<h3><i class="fas fa-download"></i> Export Opties</h3>
<div style="display:flex;gap:10px;flex-wrap:wrap">
<button class="btn btn-primary" onclick="RapportGenerator.downloadWord()" id="btnDownloadRapport" disabled><i class="fas fa-file-word"></i> Download Word</button>
<button class="btn" style="background:var(--gray);color:white" onclick="Dossier.exportJSON()"><i class="fas fa-database"></i> Export Data (JSON)</button>
</div>
</div>
</div>
<!-- SETTINGS PAGE -->
<div id="page-settings" class="page">
<div class="page-header"><h2>Instellingen</h2><p>Applicatie configuratie en licentie-informatie</p></div>
<div class="card">
<h3><i class="fas fa-id-card"></i> Licentie Informatie</h3>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:15px">
<div><strong>Licentiehouder:</strong><p id="settingsUser">Demo Gebruiker</p></div>
<div><strong>Organisatie:</strong><p id="settingsOrg">Demo Organisatie</p></div>
<div><strong>Versie:</strong><p>ZorgAnalyst Pro v1.0.0 TAURI DEMO</p></div>
<div><strong>Geldig tot:</strong><p>2026-12-31</p></div>
</div>
</div>
<div class="card" style="background:linear-gradient(135deg,rgba(111,66,193,0.1),rgba(13,110,253,0.1));border:2px dashed #6f42c1">
<h3 style="color:#6f42c1"><i class="fas fa-flask"></i> Demo Modus Actief</h3>
<p style="margin-top:10px;color:var(--gray)">Deze versie is voorgeladen met fictieve demonstratiedata voor "Zorggroep Horizon B.V."</p>
<p style="margin-top:10px;color:var(--gray)"><strong>Ingeladen:</strong> 4 bedrijven, 7 personen, 12 relaties, 8 signalen, 6 documenten</p>
<button class="btn" style="margin-top:15px;background:#6f42c1;color:white" onclick="DemoData.reset()"><i class="fas fa-redo"></i> Reset Demo Data</button>
</div>
<div class="card">
<h3><i class="fas fa-database"></i> Data Management</h3>
<p style="color:var(--gray);margin-bottom:15px">Alle data wordt lokaal opgeslagen. Geen externe servers.</p>
<div style="display:flex;gap:10px">
<button class="btn btn-danger" onclick="App.clearAllData()"><i class="fas fa-trash"></i> Wis Alle Data</button>
<button class="btn" style="background:var(--gray);color:white" onclick="App.exportAllData()"><i class="fas fa-download"></i> Exporteer Data</button>
</div>
</div>
<div class="card">
<h3><i class="fas fa-info-circle"></i> Over ZorgAnalyst Pro</h3>
<p style="margin-top:15px;line-height:1.8">
<strong>ZorgAnalyst Pro</strong> is een analysetool voor zorgfraude, ondermijning in de zorgsector, en gerelateerde criminele activiteiten.<br><br>
Ondersteunt gemeentelijke Wmo-toezichthouders, zorgkantoren, RIEC's, IGJ inspecteurs en opsporingsdiensten.<br><br>
<strong>Indicatoren:</strong> 43 zorg-relevante indicatoren (IKZ, IGJ, NZa, VNG, RIEC-LIEC).<br><br>
Ã‚Â© 2025 Knowledge by Data B.V. Alle rechten voorbehouden.
</p>
</div>
</div>
</div>
</div>
<script>
// ============================================================================
// LICENTIE CONFIGURATIE
// ============================================================================
const LICENSE={USER:'Demo Gebruiker',ORG:'Demo Organisatie',EXPIRY:'2026-12-31',PIN:'123456',FEATURES:['zorgfraude','pgb','wmo','jeugdzorg','wlz']};

// ============================================================================
// ZORG-INDICATOREN DEFINITIE - 43 INDICATOREN
// ============================================================================
const ZorgIndicatoren = {
    zorg: [
        {id:'ZOR-001',title:'Tarieven boven marktgemiddelde',severity:'hoog',desc:'Tarieven significant boven marktgemiddelde zonder onderbouwing.',keywords:['tarief','prijs','uurtarief','dagdeel'],bronnen:'IKZ 2023; VNG Factsheet',vraag:'Kunt u onderbouwen waarom uw tarieven hoger zijn dan het gemeentelijk maximum?',category:'zorg'},
        {id:'ZOR-002',title:'Alleen zware indicaties (cherry-picking)',severity:'hoog',desc:'Uitsluitend cliÃƒÂ«nten met zware indicaties, lichtere zorg wordt geweigerd.',keywords:['indicatie','zwaar','zzp3','zzp4','selectie'],bronnen:'IKZ; Rekenkamer',vraag:'Waarom heeft u uitsluitend cliÃƒÂ«nten met zware indicaties?',category:'zorg'},
        {id:'ZOR-003',title:'Geen SKJ-registratie jeugdzorgprofessionals',severity:'kritiek',desc:'Jeugdzorgprofessionals niet geregistreerd in SKJ.',keywords:['skj','registratie','jeugdzorg','beroepsregister'],bronnen:'Jeugdwet; IGJ',vraag:'Kunt u de SKJ-registratie van medewerkers overleggen?',category:'zorg'},
        {id:'ZOR-004',title:'Valse diploma\'s zorgpersoneel',severity:'kritiek',desc:'Aanwijzingen dat diploma\'s vals of vervalst zijn.',keywords:['diploma','vals','duo','certificaat'],bronnen:'IKZ 2023; DUO',vraag:'Kunt u originele diploma\'s overleggen voor DUO verificatie?',category:'zorg'},
        {id:'ZOR-005',title:'Complexe structuur met nevenbedrijven',severity:'hoog',desc:'Complexe bedrijfsstructuur met niet-zorg gerelateerde nevenbedrijven.',keywords:['structuur','vastgoed','schoonmaak','holding'],bronnen:'IKZ; VNG Factsheet',vraag:'Wat is de zakelijke noodzaak voor deze bedrijfsstructuur met vastgoed en schoonmaakbedrijven?',category:'zorg'},
        {id:'ZOR-006',title:'Doorstarter na faillissement',severity:'kritiek',desc:'Betrokkene eerder bij failliete zorgonderneming.',keywords:['doorstart','faillissement','curator'],bronnen:'IKZ; VNG',vraag:'Wat was uw rol bij het eerdere faillissement?',category:'zorg'},
        {id:'ZOR-007',title:'Ronselen cliÃƒÂ«nten voor PGB',severity:'kritiek',desc:'Actief werven van cliÃƒÂ«nten voor PGB-zorg.',keywords:['ronselen','pgb','werving'],bronnen:'IKZ; Rekenkamer',vraag:'Hoe komen cliÃƒÂ«nten bij u terecht? Maakt u gebruik van tussenpersonen?',category:'zorg'},
        {id:'ZOR-008',title:'Niet naleven zorgprotocollen',severity:'hoog',desc:'Zorgprotocollen worden niet gevolgd.',keywords:['protocol','richtlijn','kwaliteitskader'],bronnen:'IGJ; NZa; IKZ',vraag:'Hoe borgt u naleving van zorgprotocollen?',category:'zorg'},
        {id:'ZOR-009',title:'Onregelmatigheden cliÃƒÂ«ntendossiers',severity:'hoog',desc:'Dossiers onvolledig of inconsistent.',keywords:['dossier','registratie','zorgplan'],bronnen:'IGJ; IKZ 2023',vraag:'Kunt u cliÃƒÂ«ntendossiers overleggen?',category:'zorg'},
        {id:'ZOR-010',title:'Dagbesteding voor niet-zorgactiviteiten',severity:'kritiek',desc:'Locaties mogelijk voor criminele activiteiten.',keywords:['dagbesteding','hennep','crimineel'],bronnen:'IKZ; Politie; RIEC',vraag:'Welke activiteiten vinden plaats op dagbestedingslocaties?',category:'zorg'},
        {id:'ZOR-011',title:'Klachten over zorgkwaliteit',severity:'hoog',desc:'Klachten over kwaliteit of omvang van zorg.',keywords:['klacht','kwaliteit','cliÃƒÂ«nttevredenheid'],bronnen:'IGJ; Zorginstituut',vraag:'Hoe gaat u om met klachten?',category:'zorg'},
        {id:'ZOR-012',title:'Onvoldoende toezicht medewerkers',severity:'hoog',desc:'Onvoldoende supervisie op zorgverleners.',keywords:['toezicht','medewerker','supervisie'],bronnen:'IGJ; IKZ 2023',vraag:'Hoe houdt u toezicht op medewerkers?',category:'zorg'},
        {id:'ZOR-013',title:'Incidenten kwetsbare groepen',severity:'kritiek',desc:'Incidenten met kwetsbare cliÃƒÂ«nten.',keywords:['incident','veiligheid','melding'],bronnen:'IGJ',vraag:'Welke incidenten hebben zich voorgedaan?',category:'zorg'},
        {id:'ZOR-014',title:'Afwijkingen zorgregistraties',severity:'hoog',desc:'Geregistreerde zorguren wijken af van verwachting.',keywords:['registratie','afwijking','uren'],bronnen:'NZa; IKZ 2023',vraag:'Hoe verklaart u de afwijkingen in declaraties?',category:'zorg'},
        {id:'ZOR-015',title:'Verlaging kwaliteit/omvang zorg',severity:'hoog',desc:'Kwaliteit of omvang zorg verlaagd zonder reden.',keywords:['kwaliteit','verlaging','bezuiniging'],bronnen:'IGJ; Zorgkantoor',vraag:'Waarom is zorgomvang gewijzigd?',category:'zorg'},
        {id:'ZOR-016',title:'Misbruik kwetsbare cliÃƒÂ«nten',severity:'kritiek',desc:'CliÃƒÂ«nten gebruikt voor criminele activiteiten.',keywords:['misbruik','kwetsbaar','crimineel'],bronnen:'IKZ; Politie; OM',vraag:'Directe melding bij politie/OM overwegen.',category:'zorg'}
    ],
    toezicht: [
        {id:'TOE-001',title:'Beperkte samenwerking toezichthouders',severity:'hoog',desc:'Beperkte medewerking aan toezicht.',keywords:['samenwerking','toezichthouder','controle'],bronnen:'IGJ; NZa; VNG',vraag:'Waarom is samenwerking beperkt?',category:'toezicht'},
        {id:'TOE-002',title:'Niet reageren op controles',severity:'hoog',desc:'Niet of te laat reageren op controlevragen.',keywords:['reageren','controle','verzoek'],bronnen:'IGJ; Belastingdienst',vraag:'Waarom heeft u niet tijdig gereageerd?',category:'toezicht'},
        {id:'TOE-003',title:'Belemmeren toezicht',severity:'kritiek',desc:'Actief belemmeren van toezicht.',keywords:['belemmeren','toezicht','weigeren'],bronnen:'Wet BIBOB; IGJ',vraag:'Waarom wordt toegang geweigerd?',category:'toezicht'},
        {id:'TOE-004',title:'Afwezigheid bij controles',severity:'hoog',desc:'Onverklaarbare afwezigheid bij controles.',keywords:['afwezigheid','controle','aanwezig'],bronnen:'IGJ; gemeentelijk toezicht',vraag:'Waarom was u niet aanwezig?',category:'toezicht'},
        {id:'TOE-005',title:'IGJ-controles met negatieve bevindingen',severity:'hoog',desc:'Eerdere IGJ-controles met negatieve bevindingen.',keywords:['igj','controle','bevinding'],bronnen:'IGJ openbare rapporten',vraag:'Welke maatregelen na IGJ-bevindingen?',category:'toezicht'},
        {id:'TOE-006',title:'Meldingen bij fraudehelpdesk',severity:'hoog',desc:'Meldingen bij fraudehelpdesks.',keywords:['melding','fraudehelpdesk','signaal'],bronnen:'FMH; Politie',vraag:'Bent u op de hoogte van meldingen?',category:'toezicht'},
        {id:'TOE-007',title:'Eerdere negatieve BIBOB-rapportages',severity:'kritiek',desc:'Eerder negatief BIBOB-advies.',keywords:['bibob','advies','negatief'],bronnen:'LBB; RIEC',vraag:'Wat was aanleiding voor BIBOB-advies?',category:'toezicht'},
        {id:'TOE-008',title:'Onvoldoende naleving regelgeving',severity:'hoog',desc:'Wet- en regelgeving onvoldoende nageleefd.',keywords:['naleving','regelgeving','wet'],bronnen:'VNG; handhaving',vraag:'Welke maatregelen voor compliance?',category:'toezicht'},
        {id:'TOE-009',title:'Negatieve media-aandacht',severity:'hoog',desc:'Negatieve mediaberichtgeving.',keywords:['media','nieuws','publiciteit'],bronnen:'Open bronnen',vraag:'Wat is uw reactie op mediaberichtgeving?',category:'toezicht'},
        {id:'TOE-010',title:'Meldingen intimidatie',severity:'kritiek',desc:'Meldingen van intimidatie of bedreiging.',keywords:['intimidatie','bedreiging','agressie'],bronnen:'IGJ; Politie',vraag:'Ernstig signaal. Welke maatregelen?',category:'toezicht'},
        {id:'TOE-011',title:'Klachten cliÃƒÂ«nten/personeel',severity:'hoog',desc:'Structurele klachten van cliÃƒÂ«nten of personeel.',keywords:['klacht','personeel','ketenpartner'],bronnen:'IGJ; brancheorganisaties',vraag:'Hoeveel klachten ontvangen?',category:'toezicht'}
    ],
    financieel: [
        {id:'FIN-002',title:'Disproportioneel vermogen',severity:'kritiek',desc:'Vermogen niet in verhouding tot inkomen.',keywords:['vermogen','inkomen','disproportioneel'],bronnen:'AMLC',vraag:'Kunt u vermogensherkomst verklaren?',category:'financieel'},
        {id:'FIN-004',title:'Leningen onbekende derden',severity:'kritiek',desc:'Financiering door onbekende derden.',keywords:['lening','derde','financiering'],bronnen:'RIEC; FATF',vraag:'Van wie heeft u de lening ontvangen?',category:'financieel'},
        {id:'FIN-010',title:'Onregelmatige BTW-aangiften',severity:'hoog',desc:'Onregelmatigheden in BTW-aangiften.',keywords:['btw','aangifte','belasting'],bronnen:'Belastingdienst; FIOD',vraag:'Hoe past u BTW-regelgeving toe?',category:'financieel'},
        {id:'FIN-011',title:'Onregelmatigheden subsidies',severity:'hoog',desc:'Onregelmatigheden in PGB/Wmo-aanvragen.',keywords:['subsidie','pgb','wmo'],bronnen:'Rekenkamer; VNG',vraag:'Kunt u subsidieaanvragen overleggen?',category:'financieel'},
        {id:'FIN-012',title:'Hoge winstgevendheid',severity:'hoog',desc:'Onverklaarbaar hoge winstgevendheid.',keywords:['winst','marge','rendement'],bronnen:'CBS; AMLC',vraag:'Hoe verklaart u hoge winstgevendheid?',category:'financieel'},
        {id:'FIN-013',title:'Lage loonratio',severity:'hoog',desc:'Personeelskosten onverklaarbaar laag.',keywords:['loonratio','personeel','kosten'],bronnen:'CBS; Inspectie SZW',vraag:'Hoe verklaart u lage personeelskosten?',category:'financieel'}
    ],
    structuur: [
        {id:'STR-001',title:'Aanvrager lijkt stroman',severity:'kritiek',desc:'Aanwijzingen dat aanvrager stroman is.',keywords:['stroman','katvanger','tussenpersoon'],bronnen:'BFT; Van Traa',vraag:'Wie neemt feitelijk de beslissingen?',category:'structuur'},
        {id:'STR-002',title:'Jonge aanvrager zonder ervaring',severity:'hoog',desc:'Jonge aanvrager zonder track record.',keywords:['jong','ervaring','track record'],bronnen:'TNO; RIEC',vraag:'Welke ervaring heeft u in de zorgsector?',category:'structuur'},
        {id:'STR-005',title:'Onduidelijke UBO',severity:'kritiek',desc:'UBO niet transparant of verhuld.',keywords:['ubo','belanghebbende','eigenaar'],bronnen:'Wwft; EU AMLD',vraag:'Wie is de uiteindelijk belanghebbende?',category:'structuur'},
        {id:'STR-006',title:'Meerdere lagen holdings',severity:'hoog',desc:'Meerdere holdinglagen zonder noodzaak.',keywords:['holding','laag','tussenholding'],bronnen:'AMLC',vraag:'Wat is noodzaak voor holdingstructuur?',category:'structuur'},
        {id:'STR-009',title:'Complexe structuren voor intransparantie',severity:'hoog',desc:'Structuur opgezet om geldstromen te verhullen.',keywords:['complex','intransparant','verhullen'],bronnen:'AMLC; EU AMLD',vraag:'Kunt u geldstromen inzichtelijk maken?',category:'structuur'}
    ],
    documentatie: [
        {id:'DOC-004',title:'Tegenstrijdigheden in documenten',severity:'hoog',desc:'Tegenstrijdigheden tussen documenten.',keywords:['tegenstrijdigheid','inconsistent','afwijking'],bronnen:'BIBOB verificatie',vraag:'Hoe verklaart u tegenstrijdigheden?',category:'documentatie'},
        {id:'DOC-005',title:'Vervalste documenten',severity:'kritiek',desc:'Aanwijzingen van vervalste documenten.',keywords:['vervalst','manipulatie','vals'],bronnen:'Art. 4 Wet BIBOB',vraag:'Ernstig signaal. Verificatie bij bron vereist.',category:'documentatie'},
        {id:'DOC-007',title:'Valse referenties',severity:'kritiek',desc:'Referenties vals of niet verifieerbaar.',keywords:['referentie','aanbeveling','vals'],bronnen:'BFT; IKZ',vraag:'Kunnen referenties u bevestigen?',category:'documentatie'},
        {id:'DOC-008',title:'Gefingeerde diploma\'s',severity:'kritiek',desc:'Diploma\'s gefingeerd of onvoldoende.',keywords:['diploma','gefingeerd','kwalificatie'],bronnen:'IKZ; DUO',vraag:'Kunt u diploma\'s overleggen voor DUO verificatie?',category:'documentatie'},
        {id:'DOC-009',title:'Malafide uitzendbureaus/zzp\'ers',severity:'hoog',desc:'Gebruik malafide uitzendbureaus.',keywords:['uitzendbureau','zzp','malafide'],bronnen:'Inspectie SZW; SNCU',vraag:'Via welke bureaus huurt u personeel in?',category:'documentatie'}
    ],
    getAll: function() { return [...this.zorg, ...this.toezicht, ...this.financieel, ...this.structuur, ...this.documentatie]; },
    getById: function(id) { return this.getAll().find(i => i.id === id); },
    getByCategory: function(cat) { return this[cat] || []; }
};

// ============================================================================
// GRAPH DATABASE
// ============================================================================
const GraphDB = {companies:[],persons:[],relations:[],documents:[],
    addCompany: function(c) { if(!this.companies.find(x => x.kvk===c.kvk)){this.companies.push(c);App.updateStats();} },
    addPerson: function(p) { let e=this.persons.find(x=>x.name===p.name);if(e){if(p.type&&!e.types)e.types=[];if(p.type&&!e.types.includes(p.type))e.types.push(p.type);}else{p.types=p.type?[p.type]:[];this.persons.push(p);}App.updateStats(); },
    addRelation: function(f,t,r,d) { if(!this.relations.find(x=>x.from===f&&x.to===t&&x.role===r)){this.relations.push({from:f,to:t,role:r,datum:d});App.updateStats();} },
    addDocument: function(d) { this.documents.push(d);App.updateStats(); }
};

// ============================================================================
// APP STATE MANAGEMENT
// ============================================================================
const App = {
    data:null,financials:{},redFlags:[],uploadedFiles:[],
    init: function() { 
        console.log('%c ZorgAnalyst Pro v1.0.0 DEMO','font-size:16px;font-weight:bold;color:#0d6efd');
        DemoData.load();
        this.updateStats();
        this.renderUploadedFiles();
        IndicatorenBibliotheek.show('all');
        RedFlagsManager.render();
        Timeline.render();
        ActivityLog.render();
    },
    showPage: function(p) {
        document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n=>{if(n.onclick&&n.onclick.toString().includes(p))n.classList.add('active');});
        if(p==='graph')Graph.render();if(p==='timeline')Timeline.render();if(p==='redflags')RedFlagsManager.render();
    },
    updateStats: function() {
        document.getElementById('statCompanies').textContent=GraphDB.companies.length;
        document.getElementById('statPersons').textContent=GraphDB.persons.length;
        document.getElementById('statRelations').textContent=GraphDB.relations.length;
        document.getElementById('statFlags').textContent=this.redFlags.length;
        document.getElementById('statDocs').textContent=GraphDB.documents.length;
        document.getElementById('flagCount').textContent=this.redFlags.length;
    },
    addRedFlag: function(f) { if(!this.redFlags.find(x=>x.id===f.id&&x.entity===f.entity)){this.redFlags.push(f);this.updateStats();} return f; },
    addUploadedFile: function(n,t) { if(!this.uploadedFiles.find(f=>f.name===n)){this.uploadedFiles.push({name:n,type:t,date:new Date().toISOString()});this.renderUploadedFiles();} },
    isDuplicateFile: function(n) { return this.uploadedFiles.some(f=>f.name===n); },
    renderUploadedFiles: function() {
        let h='';this.uploadedFiles.forEach(f=>{
            let ic='fa-file-pdf',cl='var(--danger)';
            if(f.type==='kvk'){ic='fa-building';cl='#0066cc';}
            if(f.type==='jaarverslag'){ic='fa-book';cl='var(--success)';}
            if(f.type==='zorgplan'){ic='fa-clipboard-list';cl='var(--accent)';}
            if(f.type==='declaratie'){ic='fa-file-invoice-dollar';cl='var(--primary)';}
            if(f.type==='creditsafe'){ic='fa-chart-line';cl='#9b59b6';}
            if(f.type==='igj'){ic='fa-stethoscope';cl='var(--danger)';}
            h+='<div class="uploaded-file"><i class="fas '+ic+'" style="color:'+cl+'"></i><div class="file-info"><strong>'+f.name+'</strong><span>'+f.type+'</span></div><span class="file-status success"><i class="fas fa-check"></i> Verwerkt</span></div>';
        });
        document.getElementById('uploadedFilesList').innerHTML=h;
    },
    clearAllData: function() { 
        // Direct uitvoeren zonder confirm
        GraphDB.companies=[];GraphDB.persons=[];GraphDB.relations=[];GraphDB.documents=[];
        this.redFlags=[];this.uploadedFiles=[];this.updateStats();
        ActivityLog.entries=[];ActivityLog.render();this.renderUploadedFiles();
        document.getElementById('dossierCode').textContent = 'LEEG';
        document.getElementById('dossierMeta').textContent = 'Geen dossier geladen';
        // Visuele feedback
        document.body.style.backgroundColor = '#ffcccc';
        setTimeout(function(){ document.body.style.backgroundColor = ''; }, 500);
    },
    exportAllData: function() {
        let d={exportDate:new Date().toISOString(),version:'1.0.0-DEMO',graphDB:GraphDB,redFlags:this.redFlags,financials:this.financials,uploadedFiles:this.uploadedFiles,activityLog:ActivityLog.entries};
        let b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});let a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='ZorgAnalyst_Export_'+new Date().toISOString().split('T')[0]+'.json';a.click();
    }
};

// ============================================================================
// ACTIVITY LOG
// ============================================================================
const ActivityLog = {
    entries:[],
    add: function(t,ti,de) { this.entries.unshift({type:t,title:ti,detail:de,time:new Date().toISOString()});this.render(); },
    addNote: function() { let n=document.getElementById('noteInput').value.trim();if(!n)return;this.add('note','Aantekening',n);document.getElementById('noteInput').value=''; },
    render: function() {
        let c=document.getElementById('activityLog');if(!c)return;
        if(this.entries.length===0){c.innerHTML='<p style="color:var(--gray);text-align:center;padding:20px">Geen activiteiten</p>';return;}
        let h='';this.entries.slice(0,50).forEach(e=>{let d=new Date(e.time);
            h+='<div class="log-entry"><span class="log-time">'+d.toLocaleString('nl-NL')+'</span>';
            h+='<div class="log-icon '+e.type+'"><i class="fas fa-'+(e.type==='action'?'bolt':e.type==='note'?'sticky-note':e.type==='alert'?'exclamation-triangle':'check')+'"></i></div>';
            h+='<div class="log-content"><strong>'+e.title+'</strong><p>'+e.detail+'</p></div></div>';
        });c.innerHTML=h;
    }
};

// ============================================================================
// AUTH
// ============================================================================
const Auth = {
    attempts:3,
    verify: function() {
        let p=document.getElementById('pinInput').value;
        if(p===LICENSE.PIN){
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            document.getElementById('licenseInfo').innerHTML='<i class="fas fa-check-circle"></i> '+LICENSE.USER+' | '+LICENSE.ORG;
            document.getElementById('userDisplay').textContent=LICENSE.USER;
            document.getElementById('orgDisplay').textContent=LICENSE.ORG;
            document.getElementById('settingsUser').textContent=LICENSE.USER;
            document.getElementById('settingsOrg').textContent=LICENSE.ORG;
            App.init();
        } else {
            this.attempts--;document.getElementById('attemptsInfo').textContent='Pogingen: '+this.attempts+' resterend';
            if(this.attempts<=0){document.getElementById('authScreen').innerHTML='<div style="text-align:center;padding:60px;background:rgba(0,0,0,0.8);border-radius:16px;max-width:400px"><i class="fas fa-lock" style="font-size:4rem;color:var(--danger)"></i><h2 style="color:white;margin-top:20px">Geblokkeerd</h2></div>';}
        }
    }
};

// ============================================================================
// DEMO DATA - Fictieve data voor demonstratie
// ============================================================================
const DemoData = {
    load: function() {
        // === BEDRIJVEN (met adressen voor cross-reference) ===
        GraphDB.companies = [
            {name:'Zorggroep Horizon B.V.',kvk:'87654321',rechtsvorm:'B.V.',oprichtingsdatum:'12-03-2019',activiteit:'Wmo-ondersteuning, PGB-zorg',source:'kvk',isHoofd:true,adres:'Industrieweg 45, Amsterdam'},
            {name:'HZN Holding B.V.',kvk:'87654320',rechtsvorm:'B.V.',oprichtingsdatum:'01-01-2017',activiteit:'Houdstermaatschappij',source:'kvk',adres:'Industrieweg 45, Amsterdam'},
            {name:'Horizon Vastgoed B.V.',kvk:'87654322',rechtsvorm:'B.V.',oprichtingsdatum:'15-06-2018',activiteit:'Verhuur bedrijfspanden',source:'kvk',adres:'Industrieweg 45, Amsterdam'},
            {name:'CleanCare Services B.V.',kvk:'87654323',rechtsvorm:'B.V.',oprichtingsdatum:'20-09-2020',activiteit:'Schoonmaakdiensten',source:'kvk',adres:'Havenstraat 12, Rotterdam'}
        ];
        
        // === PERSONEN (uitgebreid) ===
        GraphDB.persons = [
            {name:'R.J. Jansen',types:['bestuurder'],geboortedatum:'15-08-1982',adres:'Hoofdstraat 45, Amsterdam'},
            {name:'M.A. de Vries',types:['bestuurder'],geboortedatum:'22-03-1975',adres:'Parkweg 12, Utrecht'},
            {name:'P.H. Bakker',types:['ubo','aandeelhouder','bestuurder'],geboortedatum:'10-11-1968',adres:'Willemstad, CuraÃƒÂ§ao'},
            {name:'S.K. Yilmaz',types:['aandeelhouder','bestuurder'],geboortedatum:'05-05-1990',adres:'Dorpsstraat 8, Almere'},
            {name:'J.M. Smit',types:['gevolmachtigde'],geboortedatum:'30-12-1985',adres:'Laan 77, Rotterdam'},
            {name:'A.B. van Dam',types:['zorgverlener'],geboortedatum:'12-06-1995',adres:'Kerkstraat 3, Den Haag'},
            {name:'L.C. Hendriks',types:['zorgverlener'],geboortedatum:'18-09-1988',adres:'Plein 15, Leiden'},
            {name:'K.L. Visser',types:['bestuurder'],geboortedatum:'03-02-1970',adres:'Onbekend',opmerking:'Uitgetreden per 31-05-2020'}
        ];
        
        // === RELATIES (uitgebreid met historische mutaties) ===
        GraphDB.relations = [
            // Holding structuur
            {from:'87654320',to:'87654321',role:'100% aandeelhouder',datum:'12-03-2019'},
            {from:'87654320',to:'87654322',role:'100% aandeelhouder',datum:'15-06-2018'},
            {from:'87654320',to:'87654323',role:'60% aandeelhouder',datum:'20-09-2020'},
            // Bestuurders Zorggroep Horizon
            {from:'87654321',to:'R.J. Jansen',role:'Bestuurder',datum:'12-03-2019'},
            {from:'87654321',to:'M.A. de Vries',role:'Bestuurder',datum:'01-06-2020'},
            {from:'87654321',to:'J.M. Smit',role:'Gevolmachtigde',datum:'15-01-2021'},
            // UBO en aandeelhouders
            {from:'87654320',to:'P.H. Bakker',role:'UBO (100%)',datum:'01-01-2017'},
            {from:'87654322',to:'P.H. Bakker',role:'Bestuurder',datum:'15-06-2018'},
            {from:'87654320',to:'P.H. Bakker',role:'Bestuurder',datum:'01-01-2017'},
            // CleanCare
            {from:'87654323',to:'S.K. Yilmaz',role:'40% aandeelhouder',datum:'20-09-2020'},
            {from:'87654323',to:'S.K. Yilmaz',role:'Bestuurder',datum:'20-09-2020'},
            {from:'87654323',to:'R.J. Jansen',role:'Bestuurder',datum:'20-09-2020'},
            // Zorgverleners
            {from:'87654321',to:'A.B. van Dam',role:'Zorgverlener (zzp)',datum:'01-03-2022'},
            {from:'87654321',to:'L.C. Hendriks',role:'Zorgverlener (zzp)',datum:'01-05-2022'},
            // Historische mutaties (uitgetreden)
            {from:'87654321',to:'K.L. Visser',role:'Bestuurder (uitgetreden)',datum:'12-03-2019',eindDatum:'31-05-2020'},
            {from:'87654322',to:'M.A. de Vries',role:'Bestuurder',datum:'01-01-2019'}
        ];
        
        // === DOCUMENTEN ===
        GraphDB.documents = [
            {name:'KvK_Uittreksel_Zorggroep_Horizon_BV.pdf',type:'kvk',date:'2025-01-10',pages:4},
            {name:'Graydon_Kredietrapport_87654321.pdf',type:'creditsafe',date:'2025-01-12',pages:12},
            {name:'Jaarrekening_2023_Zorggroep_Horizon.pdf',type:'jaarverslag',date:'2025-01-08',pages:28},
            {name:'PGB_Declaratieoverzicht_Q3_Q4_2024.pdf',type:'declaratie',date:'2025-01-14',pages:45},
            {name:'IGJ_Inspectierapport_nov2024.pdf',type:'igj',date:'2024-11-20',pages:8},
            {name:'Wmo_Aanvraag_Gemeente_Amsterdam.pdf',type:'zorgplan',date:'2024-09-15',pages:6}
        ];
        
        // === UPLOADED FILES ===
        App.uploadedFiles = [
            {name:'KvK_Uittreksel_Zorggroep_Horizon_BV.pdf',type:'kvk',date:'2025-01-10T09:15:00'},
            {name:'Graydon_Kredietrapport_87654321.pdf',type:'creditsafe',date:'2025-01-12T10:30:00'},
            {name:'Jaarrekening_2023_Zorggroep_Horizon.pdf',type:'jaarverslag',date:'2025-01-08T14:20:00'},
            {name:'PGB_Declaratieoverzicht_Q3_Q4_2024.pdf',type:'declaratie',date:'2025-01-14T11:45:00'},
            {name:'IGJ_Inspectierapport_nov2024.pdf',type:'igj',date:'2024-11-20T16:00:00'},
            {name:'Wmo_Aanvraag_Gemeente_Amsterdam.pdf',type:'zorgplan',date:'2024-09-15T13:10:00'}
        ];
        
        // === RED FLAGS / SIGNALEN ===
        App.redFlags = [
            {id:'ZOR-005',title:'Complexe structuur met nevenbedrijven',severity:'kritiek',desc:'Zorggroep Horizon B.V. maakt deel uit van een structuur met vastgoed- en schoonmaakbedrijven zonder duidelijke zorg-gerelateerde noodzaak. Holding (HZN Holding B.V.) is 100% eigenaar.',category:'zorg',source:'KvK analyse',bronnen:'IKZ; VNG Factsheet',entity:'Zorggroep Horizon B.V.',detectedAt:'2025-01-10T09:30:00'},
            {id:'STR-005',title:'Onduidelijke UBO',severity:'kritiek',desc:'UBO P.H. Bakker staat geregistreerd op adres in CuraÃƒÂ§ao. Daadwerkelijke verblijfplaats en vermogensherkomst onduidelijk.',category:'structuur',source:'KvK + Kadaster',bronnen:'Wwft; EU AMLD',entity:'P.H. Bakker',detectedAt:'2025-01-10T09:45:00'},
            {id:'ZOR-001',title:'Tarieven boven marktgemiddelde',severity:'hoog',desc:'Gehanteerd uurtarief van Ã¢â€šÂ¬68,- ligt 23% boven het gemeentelijk maximumtarief van Ã¢â€šÂ¬55,-. Geen onderbouwing voor hogere kwaliteit.',category:'zorg',source:'Declaratie analyse',bronnen:'IKZ 2023; VNG',entity:'Zorggroep Horizon B.V.',detectedAt:'2025-01-14T12:00:00'},
            {id:'ZOR-014',title:'Afwijkingen zorgregistraties',severity:'hoog',desc:'Op 14 dagen zijn meer dan 16 uur per dag gedeclareerd. Maximum 22 uur op ÃƒÂ©ÃƒÂ©n dag voor dezelfde cliÃƒÂ«nt. Fysiek onmogelijk.',category:'zorg',source:'PGB Declaraties Q3-Q4',bronnen:'NZa; IKZ 2023',entity:'Zorggroep Horizon B.V.',detectedAt:'2025-01-14T12:15:00'},
            {id:'FIN-012',title:'Hoge winstgevendheid',severity:'hoog',desc:'Nettowinstmarge van 28% ligt significant boven sectorgemiddelde van 8%. Personeelskosten zijn relatief laag (loonratio 42% vs sector 65%).',category:'financieel',source:'Jaarrekening 2023',bronnen:'CBS; AMLC',entity:'Zorggroep Horizon B.V.',detectedAt:'2025-01-08T14:45:00'},
            {id:'TOE-005',title:'IGJ-controles met negatieve bevindingen',severity:'hoog',desc:'IGJ inspectie november 2024 constateerde tekortkomingen in medicatieveiligheid en dossiervoering. Verbeterplan vereist.',category:'toezicht',source:'IGJ Rapport nov 2024',bronnen:'IGJ openbare rapporten',entity:'Zorggroep Horizon B.V.',detectedAt:'2024-11-20T16:30:00'},
            {id:'STR-006',title:'Meerdere lagen holdings',severity:'hoog',desc:'Drielaagse structuur (Holding -> Zorg BV -> Operatie) zonder aantoonbare zakelijke noodzaak. Geldstromen tussen entiteiten onduidelijk.',category:'structuur',source:'KvK + Jaarrekening',bronnen:'AMLC',entity:'HZN Holding B.V.',detectedAt:'2025-01-10T10:00:00'},
            {id:'DOC-004',title:'Tegenstrijdigheden in documenten',severity:'gemiddeld',desc:'Personeelsbestand in jaarrekening (12 FTE) wijkt af van Wmo-aanvraag (18 medewerkers). Verklaring ontbreekt.',category:'documentatie',source:'Jaarrekening vs Wmo-aanvraag',bronnen:'BIBOB verificatie',entity:'Zorggroep Horizon B.V.',detectedAt:'2025-01-14T13:00:00'}
        ];
        
        // === FINANCIALS ===
        App.financials = {
            jaar:'2023',
            omzet:1850000,
            nettoResultaat:518000,
            eigenvermogen:420000,
            personeelskosten:777000,
            aantalFTE:12,
            winstmarge:28
        };
        
        // === ACTIVITY LOG ===
        ActivityLog.entries = [
            {type:'success',title:'Onderzoek gestart',detail:'Wmo-toezicht Zorggroep Horizon B.V. (ZA-2025-0847)',time:'2025-01-15T08:30:00'},
            {type:'action',title:'Document upload',detail:'KvK_Uittreksel_Zorggroep_Horizon_BV.pdf',time:'2025-01-10T09:15:00'},
            {type:'alert',title:'Signaal gedetecteerd',detail:'ZOR-005: Complexe structuur met nevenbedrijven',time:'2025-01-10T09:30:00'},
            {type:'alert',title:'Signaal gedetecteerd',detail:'STR-005: Onduidelijke UBO',time:'2025-01-10T09:45:00'},
            {type:'action',title:'Document upload',detail:'Graydon_Kredietrapport_87654321.pdf',time:'2025-01-12T10:30:00'},
            {type:'action',title:'Document upload',detail:'Jaarrekening_2023_Zorggroep_Horizon.pdf',time:'2025-01-08T14:20:00'},
            {type:'alert',title:'Signaal gedetecteerd',detail:'FIN-012: Hoge winstgevendheid (28%)',time:'2025-01-08T14:45:00'},
            {type:'action',title:'Document upload',detail:'PGB_Declaratieoverzicht_Q3_Q4_2024.pdf',time:'2025-01-14T11:45:00'},
            {type:'alert',title:'Signaal gedetecteerd',detail:'ZOR-014: Onmogelijke uren (max 22u/dag)',time:'2025-01-14T12:15:00'},
            {type:'alert',title:'Signaal gedetecteerd',detail:'ZOR-001: Tarieven 23% boven maximum',time:'2025-01-14T12:00:00'},
            {type:'note',title:'Aantekening',detail:'Contact opgenomen met gemeente Amsterdam voor verificatie Wmo-contract.',time:'2025-01-14T14:30:00'},
            {type:'success',title:'Bron geraadpleegd',detail:'SKJ Register - geen registraties gevonden voor medewerkers',time:'2025-01-14T15:00:00'},
            {type:'note',title:'Aantekening',detail:'UBO P.H. Bakker ook betrokken bij failliet Zorg & Co B.V. (2016). Nader onderzoek vereist.',time:'2025-01-15T09:00:00'}
        ];
        
        // Dossier code
        Dossier.currentCode = 'ZA-2025-0847';
    },
    
    reset: function() {
        // Direct uitvoeren
        this.load();
        App.updateStats();
        App.renderUploadedFiles();
        ActivityLog.render();
        RedFlagsManager.render();
        Timeline.render();
        // Visuele feedback
        document.body.style.backgroundColor = '#ccffcc';
        setTimeout(function(){ document.body.style.backgroundColor = ''; }, 500);
    },
    
    reload: function() {
        // Direct uitvoeren
        this.load();
        App.updateStats();
        App.renderUploadedFiles();
        ActivityLog.render();
        RedFlagsManager.render();
        Timeline.render();
        document.getElementById('dossierCode').textContent = 'ZA-2025-0847';
        document.getElementById('dossierMeta').textContent = 'Wmo-toezicht | Zorggroep Horizon B.V. | Gestart: 15-01-2025';
        Overview.recalculateScore();
        // Visuele feedback - groen flitsen
        document.body.style.backgroundColor = '#ccffcc';
        setTimeout(function(){ document.body.style.backgroundColor = ''; }, 500);
    }
};

// ============================================================================
// GRAPH VISUALIZATION
// ============================================================================
const Graph = {
    svg:null,simulation:null,zoom:null,
    render: function() {
        let c=document.getElementById('graphContainer');c.innerHTML='';
        if(GraphDB.companies.length===0){c.innerHTML='<p style="color:var(--gray);text-align:center;padding:100px">Geen data</p>';return;}
        let w=c.clientWidth||800,h=c.clientHeight||400;let nodes=[],links=[];
        GraphDB.companies.forEach(x=>nodes.push({id:x.kvk,name:x.name,type:x.name.includes('Holding')?'holding':'company',data:x}));
        GraphDB.persons.forEach(x=>nodes.push({id:x.name,name:x.name,type:'person',ptype:x.types?x.types[0]:'person',data:x}));
        GraphDB.relations.forEach(r=>{
            let s=nodes.find(n=>n.id===r.from||n.name===r.from);
            let t=nodes.find(n=>n.id===r.to||n.name===r.to);
            if(s&&t)links.push({source:s.id,target:t.id,role:r.role});
        });
        this.svg=d3.select(c).append('svg').attr('width',w).attr('height',h);let g=this.svg.append('g');
        this.zoom=d3.zoom().scaleExtent([0.1,4]).on('zoom',e=>g.attr('transform',e.transform));this.svg.call(this.zoom);
        this.simulation=d3.forceSimulation(nodes).force('link',d3.forceLink(links).id(d=>d.id).distance(120)).force('charge',d3.forceManyBody().strength(-400)).force('center',d3.forceCenter(w/2,h/2));
        let link=g.append('g').selectAll('line').data(links).enter().append('line').attr('class','link').attr('stroke-width',2);
        let node=g.append('g').selectAll('.node').data(nodes).enter().append('g').attr('class','node').call(d3.drag().on('start',(e,d)=>{if(!e.active)this.simulation.alphaTarget(0.3).restart();d.fx=d.x;d.fy=d.y;}).on('drag',(e,d)=>{d.fx=e.x;d.fy=e.y;}).on('end',(e,d)=>{if(!e.active)this.simulation.alphaTarget(0);d.fx=null;d.fy=null;}));
        node.append('circle').attr('r',d=>d.type==='company'||d.type==='holding'?28:20)
            .attr('fill',d=>{
                if(d.type==='holding')return '#6f42c1';
                if(d.type==='company')return 'var(--accent)';
                if(d.ptype==='ubo')return 'var(--danger)';
                if(d.ptype==='bestuurder')return 'var(--success)';
                if(d.ptype==='aandeelhouder')return 'var(--warning)';
                return 'var(--primary)';
            });
        node.append('text').attr('dy',d=>d.type==='company'||d.type==='holding'?45:32).attr('text-anchor','middle').style('font-size','9px').text(d=>d.name.length>25?d.name.substring(0,25)+'...':d.name);
        this.simulation.on('tick',()=>{link.attr('x1',d=>d.source.x).attr('y1',d=>d.source.y).attr('x2',d=>d.target.x).attr('y2',d=>d.target.y);node.attr('transform',d=>'translate('+d.x+','+d.y+')');});
        this.updateFilter();
    },
    updateFilter: function() {
        let h='<p style="font-size:0.75rem;color:var(--gray);margin-bottom:10px"><strong>Bedrijven:</strong></p>';
        GraphDB.companies.forEach(c=>{h+='<label style="display:flex;align-items:center;gap:8px;padding:4px 0;cursor:pointer;font-size:0.8rem"><input type="checkbox" checked style="accent-color:var(--accent)"><span>'+c.name.substring(0,25)+'</span></label>';});
        h+='<p style="font-size:0.75rem;color:var(--gray);margin:15px 0 10px 0"><strong>Personen:</strong></p>';
        GraphDB.persons.forEach(p=>{h+='<label style="display:flex;align-items:center;gap:8px;padding:4px 0;cursor:pointer;font-size:0.8rem"><input type="checkbox" checked style="accent-color:var(--success)"><span>'+p.name+'</span></label>';});
        document.getElementById('graphFilter').innerHTML=h;
    },
    zoomIn: function(){this.svg?.transition().call(this.zoom.scaleBy,1.3);},
    zoomOut: function(){this.svg?.transition().call(this.zoom.scaleBy,0.7);},
    zoomReset: function(){this.svg?.transition().call(this.zoom.transform,d3.zoomIdentity);},
    selectAll: function(){this.render();},
    selectNone: function(){document.getElementById('graphContainer').innerHTML='<p style="text-align:center;padding:100px;color:var(--gray)">Gefilterd</p>';}
};

// ============================================================================
// TIMELINE - Uitgebreid met categorieÃƒÂ«n en cross-reference
// ============================================================================
const Timeline = {
    events: [],
    currentFilter: 'all',
    
    buildEvents: function() {
        this.events = [];
        
        // KvK Inschrijvingen
        GraphDB.companies.forEach(c => {
            if(c.oprichtingsdatum) {
                this.events.push({
                    date: c.oprichtingsdatum,
                    title: 'KvK Inschrijving: ' + c.name,
                    subtitle: 'KvK: ' + c.kvk + ' | ' + c.rechtsvorm,
                    icon: 'building',
                    color: '#0066cc',
                    type: 'inschrijving',
                    entity: c.name
                });
            }
        });
        
        // Bestuurders en aandeelhouders
        GraphDB.relations.forEach(r => {
            if(r.datum) {
                let type = 'relatie';
                let icon = 'link';
                let color = 'var(--primary)';
                let title = r.role;
                
                if(r.role.toLowerCase().includes('bestuurder')) {
                    type = 'bestuurder';
                    icon = 'user-tie';
                    color = 'var(--success)';
                    title = 'Bestuurder aangetreden';
                } else if(r.role.toLowerCase().includes('aandeelhouder') || r.role.toLowerCase().includes('ubo')) {
                    type = 'aandeelhouder';
                    icon = 'hand-holding-usd';
                    color = '#6f42c1';
                    title = 'Aandeelhouder/UBO';
                } else if(r.role.toLowerCase().includes('gevolmachtigde')) {
                    type = 'bestuurder';
                    icon = 'user-shield';
                    color = 'var(--warning)';
                    title = 'Gevolmachtigde aangesteld';
                }
                
                let company = GraphDB.companies.find(c => c.kvk === r.from);
                this.events.push({
                    date: r.datum,
                    title: title,
                    subtitle: r.to + ' Ã¢â€ â€™ ' + (company ? company.name : r.from),
                    detail: r.role,
                    icon: icon,
                    color: color,
                    type: type,
                    entity: r.to
                });
            }
        });
        
        // Signalen
        App.redFlags.forEach(f => {
            if(f.detectedAt) {
                let d = new Date(f.detectedAt);
                this.events.push({
                    date: d.toLocaleDateString('nl-NL'),
                    sortDate: d,
                    title: 'SIGNAAL: ' + f.title,
                    subtitle: f.entity || 'Algemeen',
                    detail: f.desc,
                    icon: 'flag',
                    color: f.severity === 'kritiek' ? 'var(--danger)' : 'var(--hoog)',
                    type: 'signaal',
                    severity: f.severity,
                    entity: f.entity
                });
            }
        });
        
        // Documenten
        GraphDB.documents.forEach(d => {
            if(d.date) {
                let dt = new Date(d.date);
                this.events.push({
                    date: dt.toLocaleDateString('nl-NL'),
                    sortDate: dt,
                    title: 'Document: ' + d.type.toUpperCase(),
                    subtitle: d.name,
                    icon: 'file-alt',
                    color: 'var(--gray)',
                    type: 'document',
                    entity: d.name
                });
            }
        });
        
        // Sort by date (newest first)
        this.events.sort((a, b) => {
            let da = a.sortDate || this.parseDate(a.date);
            let db = b.sortDate || this.parseDate(b.date);
            return db - da;
        });
    },
    
    parseDate: function(dateStr) {
        if(!dateStr) return new Date(0);
        if(dateStr.includes('-')) {
            let parts = dateStr.split('-');
            if(parts[0].length === 4) return new Date(dateStr);
            return new Date(parts[2], parts[1]-1, parts[0]);
        }
        return new Date(dateStr);
    },
    
    filter: function(type) {
        this.currentFilter = type;
        this.render();
    },
    
    render: function() {
        this.buildEvents();
        
        let filtered = this.currentFilter === 'all' 
            ? this.events 
            : this.events.filter(e => e.type === this.currentFilter);
        
        let c = document.getElementById('timelineContainer');
        if(filtered.length === 0) {
            c.innerHTML = '<p style="color:var(--gray);text-align:center;padding:40px">Geen events gevonden</p>';
        } else {
            let h = '';
            filtered.forEach(e => {
                h += '<div style="display:flex;gap:15px;padding:15px 0;border-bottom:1px solid #eee">';
                h += '<div style="width:90px;font-size:0.8rem;color:var(--gray);font-family:monospace">' + e.date + '</div>';
                h += '<div style="width:40px;height:40px;border-radius:50%;background:' + e.color + ';display:flex;align-items:center;justify-content:center;color:white;flex-shrink:0"><i class="fas fa-' + e.icon + '"></i></div>';
                h += '<div style="flex:1">';
                h += '<strong style="color:' + (e.type === 'signaal' ? e.color : 'var(--dark)') + '">' + e.title + '</strong>';
                if(e.severity) h += '<span class="indicator-badge ' + e.severity + '" style="margin-left:10px">' + e.severity + '</span>';
                if(e.subtitle) h += '<p style="font-size:0.85rem;color:var(--gray);margin:3px 0 0 0">' + e.subtitle + '</p>';
                if(e.detail && e.type !== 'signaal') h += '<p style="font-size:0.8rem;color:var(--gray);margin:3px 0 0 0;font-style:italic">' + e.detail + '</p>';
                h += '</div></div>';
            });
            c.innerHTML = h;
        }
        
        this.renderCrossReferences();
        this.renderMutations();
    },
    
    renderCrossReferences: function() {
        let c = document.getElementById('crossReferenceContainer');
        let refs = [];
        
        // Personen met meerdere rollen
        GraphDB.persons.forEach(p => {
            let roles = GraphDB.relations.filter(r => r.to === p.name);
            if(roles.length > 1) {
                refs.push({
                    type: 'multi_role',
                    title: p.name + ' - Meerdere functies',
                    detail: roles.map(r => {
                        let comp = GraphDB.companies.find(c => c.kvk === r.from);
                        return r.role + ' bij ' + (comp ? comp.name : r.from);
                    }).join(', '),
                    severity: roles.length > 2 ? 'hoog' : 'gemiddeld',
                    icon: 'user-friends'
                });
            }
        });
        
        // Bedrijven met zelfde bestuurder
        let bestuurders = {};
        GraphDB.relations.filter(r => r.role.toLowerCase().includes('bestuurder')).forEach(r => {
            if(!bestuurders[r.to]) bestuurders[r.to] = [];
            let comp = GraphDB.companies.find(c => c.kvk === r.from);
            bestuurders[r.to].push(comp ? comp.name : r.from);
        });
        Object.keys(bestuurders).forEach(naam => {
            if(bestuurders[naam].length > 1) {
                refs.push({
                    type: 'shared_director',
                    title: 'Gedeelde bestuurder: ' + naam,
                    detail: 'Bestuurder bij: ' + bestuurders[naam].join(', '),
                    severity: 'hoog',
                    icon: 'sitemap'
                });
            }
        });
        
        // Adres overlap (als we adressen hebben)
        let addresses = {};
        GraphDB.companies.forEach(c => {
            if(c.adres) {
                if(!addresses[c.adres]) addresses[c.adres] = [];
                addresses[c.adres].push(c.name);
            }
        });
        Object.keys(addresses).forEach(adres => {
            if(addresses[adres].length > 1) {
                refs.push({
                    type: 'shared_address',
                    title: 'Gedeeld vestigingsadres',
                    detail: addresses[adres].join(', ') + ' op ' + adres,
                    severity: 'gemiddeld',
                    icon: 'map-marker-alt'
                });
            }
        });
        
        // UBO in buitenland
        GraphDB.persons.forEach(p => {
            if(p.adres && (p.adres.includes('CuraÃƒÂ§ao') || p.adres.includes('Dubai') || p.adres.includes('Malta') || p.adres.includes('Cyprus'))) {
                let isUbo = GraphDB.relations.find(r => r.to === p.name && r.role.toLowerCase().includes('ubo'));
                if(isUbo) {
                    refs.push({
                        type: 'foreign_ubo',
                        title: 'UBO in buitenland: ' + p.name,
                        detail: 'Geregistreerd adres: ' + p.adres,
                        severity: 'kritiek',
                        icon: 'globe'
                    });
                }
            }
        });
        
        // Holding structuur
        let holdings = GraphDB.companies.filter(c => c.name.toLowerCase().includes('holding') || c.activiteit?.toLowerCase().includes('houdster'));
        if(holdings.length > 0) {
            let subs = GraphDB.relations.filter(r => r.role.toLowerCase().includes('aandeelhouder') && holdings.some(h => h.kvk === r.from));
            if(subs.length > 0) {
                refs.push({
                    type: 'holding_structure',
                    title: 'Holdingstructuur gedetecteerd',
                    detail: holdings.map(h => h.name).join(', ') + ' met ' + subs.length + ' deelnemingen',
                    severity: 'gemiddeld',
                    icon: 'layer-group'
                });
            }
        }
        
        if(refs.length === 0) {
            c.innerHTML = '<p style="color:var(--gray);text-align:center;padding:30px"><i class="fas fa-check-circle" style="color:var(--success);margin-right:8px"></i>Geen opvallende cross-references gevonden</p>';
        } else {
            let h = '<div style="display:grid;gap:12px">';
            refs.forEach(r => {
                let col = r.severity === 'kritiek' ? 'var(--danger)' : r.severity === 'hoog' ? 'var(--hoog)' : 'var(--warning)';
                h += '<div style="padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid ' + col + '">';
                h += '<div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">';
                h += '<i class="fas fa-' + r.icon + '" style="color:' + col + '"></i>';
                h += '<strong>' + r.title + '</strong>';
                h += '<span class="indicator-badge ' + r.severity + '">' + r.severity + '</span>';
                h += '</div>';
                h += '<p style="font-size:0.85rem;color:var(--gray);margin:0">' + r.detail + '</p>';
                h += '</div>';
            });
            h += '</div>';
            c.innerHTML = h;
        }
    },
    
    renderMutations: function() {
        let c = document.getElementById('mutationsContainer');
        
        // Groepeer mutaties per bedrijf
        let mutations = [];
        GraphDB.companies.forEach(comp => {
            let compRels = GraphDB.relations.filter(r => r.from === comp.kvk);
            let bestuurders = compRels.filter(r => r.role.toLowerCase().includes('bestuurder') || r.role.toLowerCase().includes('gevolmachtigde'));
            let aandeelhouders = compRels.filter(r => r.role.toLowerCase().includes('aandeelhouder') || r.role.toLowerCase().includes('ubo'));
            
            if(bestuurders.length > 0 || aandeelhouders.length > 0) {
                mutations.push({
                    company: comp.name,
                    kvk: comp.kvk,
                    oprichting: comp.oprichtingsdatum,
                    bestuurders: bestuurders,
                    aandeelhouders: aandeelhouders
                });
            }
        });
        
        if(mutations.length === 0) {
            c.innerHTML = '<p style="color:var(--gray);text-align:center;padding:30px">Geen mutaties beschikbaar</p>';
            return;
        }
        
        let h = '';
        mutations.forEach(m => {
            h += '<div style="background:#f8f9fa;border-radius:10px;padding:20px;margin-bottom:15px">';
            h += '<h4 style="margin-bottom:15px;color:var(--dark)"><i class="fas fa-building" style="color:var(--accent);margin-right:8px"></i>' + m.company + ' <span style="font-weight:normal;color:var(--gray);font-size:0.85rem">(KvK: ' + m.kvk + ')</span></h4>';
            
            if(m.bestuurders.length > 0) {
                h += '<div style="margin-bottom:15px"><p style="font-weight:600;font-size:0.85rem;color:var(--success);margin-bottom:8px"><i class="fas fa-user-tie"></i> Bestuurders/Gevolmachtigden</p>';
                h += '<table style="width:100%;font-size:0.85rem;border-collapse:collapse">';
                m.bestuurders.forEach(b => {
                    h += '<tr><td style="padding:6px 10px;border-bottom:1px solid #e0e0e0;width:120px;color:var(--gray)">' + (b.datum || '-') + '</td>';
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0"><strong>' + b.to + '</strong></td>';
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0;color:var(--gray)">' + b.role + '</td>';
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0"><span style="background:var(--success);color:white;padding:2px 8px;border-radius:4px;font-size:0.7rem">ACTIEF</span></td></tr>';
                });
                h += '</table></div>';
            }
            
            if(m.aandeelhouders.length > 0) {
                h += '<div><p style="font-weight:600;font-size:0.85rem;color:#6f42c1;margin-bottom:8px"><i class="fas fa-hand-holding-usd"></i> Aandeelhouders/UBO</p>';
                h += '<table style="width:100%;font-size:0.85rem;border-collapse:collapse">';
                m.aandeelhouders.forEach(a => {
                    h += '<tr><td style="padding:6px 10px;border-bottom:1px solid #e0e0e0;width:120px;color:var(--gray)">' + (a.datum || '-') + '</td>';
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0"><strong>' + a.to + '</strong></td>';
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0;color:var(--gray)">' + a.role + '</td>';
                    let isUbo = a.role.toLowerCase().includes('ubo');
                    h += '<td style="padding:6px 10px;border-bottom:1px solid #e0e0e0"><span style="background:' + (isUbo ? 'var(--danger)' : '#6f42c1') + ';color:white;padding:2px 8px;border-radius:4px;font-size:0.7rem">' + (isUbo ? 'UBO' : 'AANDEELH.') + '</span></td></tr>';
                });
                h += '</table></div>';
            }
            
            h += '</div>';
        });
        
        c.innerHTML = h;
    }
};

// ============================================================================
// RED FLAGS MANAGER
// ============================================================================
const RedFlagsManager = {
    render: function() {
        let c=document.getElementById('redFlagsList');let fl=App.redFlags;
        let cf=document.getElementById('flagFilter')?.value||'all';let sf=document.getElementById('severityFilter')?.value||'all';
        if(cf!=='all')fl=fl.filter(f=>f.category===cf);if(sf!=='all')fl=fl.filter(f=>f.severity===sf);
        if(fl.length===0){c.innerHTML='<p style="color:var(--gray);text-align:center;padding:40px"><i class="fas fa-check-circle" style="font-size:3rem;color:var(--success);display:block;margin-bottom:15px"></i>Geen signalen met huidige filters.</p>';return;}
        let so={kritiek:0,hoog:1,gemiddeld:2};fl.sort((a,b)=>so[a.severity]-so[b.severity]);
        let h='';fl.forEach(f=>{
            let cl=f.severity==='kritiek'?'var(--kritiek)':f.severity==='hoog'?'var(--hoog)':'var(--gemiddeld)';
            h+='<div class="red-flag '+f.severity+'" style="border-left-color:'+cl+'">';
            h+='<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px;flex-wrap:wrap;gap:10px">';
            h+='<h4 style="margin:0;color:'+cl+'"><i class="fas fa-flag"></i> '+f.title+'</h4>';
            h+='<div><span class="indicator-badge '+f.severity+'">'+f.severity.toUpperCase()+'</span><span class="category-tag '+f.category+'">'+f.id+'</span></div></div>';
            h+='<p style="margin-bottom:10px">'+f.desc+'</p>';
            if(f.entity)h+='<p style="font-size:0.8rem;color:var(--dark);margin-bottom:5px"><i class="fas fa-building"></i> <strong>'+f.entity+'</strong></p>';
            if(f.bronnen)h+='<p style="font-size:0.8rem;color:var(--gray)"><i class="fas fa-book"></i> '+f.bronnen+'</p>';
            if(f.source)h+='<p style="font-size:0.8rem;color:var(--gray)"><i class="fas fa-file"></i> '+f.source+'</p>';
            h+='</div>';
        });c.innerHTML=h;
    }
};

// ============================================================================
// INDICATOREN BIBLIOTHEEK
// ============================================================================
const IndicatorenBibliotheek = {
    show: function(cat) {
        let ind=cat==='all'?ZorgIndicatoren.getAll():ZorgIndicatoren.getByCategory(cat);
        let c=document.getElementById('indicatorenBibliotheek');
        let h='';ind.forEach(i=>{
            let cl=i.severity==='kritiek'?'var(--kritiek)':i.severity==='hoog'?'var(--hoog)':'var(--gemiddeld)';
            h+='<div style="padding:12px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;border-left:3px solid '+cl+'">';
            h+='<div style="display:flex;justify-content:space-between;align-items:center"><strong style="font-size:0.9rem">'+i.id+': '+i.title+'</strong><span class="indicator-badge '+i.severity+'">'+i.severity+'</span></div>';
            h+='<p style="font-size:0.8rem;color:var(--gray);margin:5px 0">'+i.desc+'</p>';
            h+='<p style="font-size:0.75rem;color:var(--gray)"><i class="fas fa-book"></i> '+i.bronnen+'</p></div>';
        });c.innerHTML=h;
    }
};

// ============================================================================
// SOURCES
// ============================================================================
const Sources = {
    urls:{kvk:'https://www.kvk.nl/zoeken/',skj:'https://skjeugd.nl/register/',big:'https://www.bigregister.nl/',igj:'https://www.igj.nl/publicaties',nza:'https://www.nza.nl/',ikz:'https://www.ikz.nl/'},
    open: function(s){let u=this.urls[s];if(u){window.open(u,'_blank');ActivityLog.add('action','Bron geopend',s);}}
};

// ============================================================================
// INTERVIEW MODULE
// ============================================================================
const InterviewModule = {
    generated:false,
    generate: function() {
        let fl=App.redFlags;if(fl.length===0){alert('Geen signalen.');return;}
        let t=document.getElementById('interviewType').value;let co=GraphDB.companies.find(c=>c.isHoofd)||GraphDB.companies[0];
        let target=document.getElementById('interviewTarget').value;
        let h='<h4 style="color:var(--primary);margin-bottom:15px">INTERVIEWFORMULIER ZORGFRAUDE ONDERZOEK</h4>';
        h+='<p style="margin-bottom:5px"><strong>Zorgaanbieder:</strong> '+(co?.name||'[Naam]')+'</p>';
        h+='<p style="margin-bottom:5px"><strong>Type:</strong> '+t+'</p>';
        h+='<p style="margin-bottom:5px"><strong>GeÃƒÂ¯nterviewde:</strong> '+(target||'[Selecteer]')+'</p>';
        h+='<p style="margin-bottom:5px"><strong>Datum:</strong> '+new Date().toLocaleDateString('nl-NL')+'</p>';
        h+='<p style="margin-bottom:20px"><strong>Onderzoeker:</strong> '+LICENSE.USER+'</p><hr style="margin:20px 0">';
        fl.forEach((f,i)=>{
            let ind=ZorgIndicatoren.getById(f.id);
            h+='<div style="background:white;padding:15px;border-radius:8px;margin-bottom:15px;border-left:3px solid '+(f.severity==='kritiek'?'var(--danger)':'var(--hoog)')+'">';
            h+='<p style="font-weight:600;margin-bottom:8px;color:var(--dark)">Vraag '+(i+1)+': '+f.title+' <span class="indicator-badge '+f.severity+'">'+f.severity+'</span></p>';
            h+='<p style="color:var(--gray);font-size:0.9rem;margin-bottom:10px"><em>Bevinding: '+f.desc+'</em></p>';
            if(ind?.vraag)h+='<p style="color:var(--primary);font-weight:500;background:#e7f1ff;padding:10px;border-radius:6px"><i class="fas fa-question-circle"></i> '+ind.vraag+'</p>';
            h+='<div style="margin-top:10px;padding:10px;background:#f8f9fa;border-radius:4px"><p style="color:var(--gray);font-size:0.85rem">Antwoord:</p><div style="min-height:60px;border-bottom:1px solid #ddd;margin-top:5px"></div></div></div>';
        });
        document.getElementById('interviewPreview').innerHTML=h;document.getElementById('interviewPreview').style.display='block';document.getElementById('interviewEmpty').style.display='none';document.getElementById('btnDownloadInterview').disabled=false;
        this.generated=true;ActivityLog.add('success','Interview gegenereerd',fl.length+' vragen');
    },
    downloadWord: function() {if(!this.generated)return;let c=document.getElementById('interviewPreview').innerText;let b=new Blob([c],{type:'application/msword'});let a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='ZorgAnalyst_Interview_'+new Date().toISOString().split('T')[0]+'.doc';a.click();}
};

// ============================================================================
// RAPPORT GENERATOR
// ============================================================================
const RapportGenerator = {
    generated:false,
    generate: function() {
        let t=document.getElementById('rapportType').value;let adv=document.getElementById('adviceType').value;
        if(!adv){alert('Selecteer adviestype');return;}
        let co=GraphDB.companies.find(c=>c.isHoofd)||GraphDB.companies[0]||{name:'[Zorgaanbieder]',kvk:'-'};let fl=App.redFlags;
        let at={positief:'Geen bezwaren - Geen significante risico-indicatoren geconstateerd.',voorwaardelijk:'Voorwaardelijk positief - Er zijn aandachtspunten die nadere monitoring vereisen.',negatief:'Negatief - Er zijn ernstige risico-indicatoren geconstateerd die nader onderzoek en/of handhaving rechtvaardigen.',nader:'Nader onderzoek nodig - De huidige informatie is onvoldoende voor een definitief advies.'};
        let h='<div style="font-family:Georgia,serif"><div style="text-align:center;padding:20px;border-bottom:3px solid var(--primary)">';
        h+='<h1 style="color:var(--primary);margin:0;font-size:1.8rem">ONDERZOEKSRAPPORT</h1>';
        h+='<h2 style="color:var(--gray);font-weight:normal;margin:10px 0;font-size:1.2rem">ZorgAnalyst Pro - '+t+'</h2>';
        h+='<p style="color:var(--gray);font-size:0.9rem">Dossiernummer: '+Dossier.currentCode+'</p></div>';
        h+='<div style="padding:20px">';
        h+='<h3 style="color:var(--primary);border-bottom:2px solid var(--primary);padding-bottom:5px">1. Onderwerp van Onderzoek</h3>';
        h+='<table style="width:100%;margin:15px 0;border-collapse:collapse">';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa;width:150px"><strong>Zorgaanbieder</strong></td><td style="padding:8px;border:1px solid #ddd">'+co.name+'</td></tr>';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa"><strong>KvK-nummer</strong></td><td style="padding:8px;border:1px solid #ddd">'+co.kvk+'</td></tr>';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa"><strong>Rechtsvorm</strong></td><td style="padding:8px;border:1px solid #ddd">'+(co.rechtsvorm||'-')+'</td></tr>';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa"><strong>Oprichtingsdatum</strong></td><td style="padding:8px;border:1px solid #ddd">'+(co.oprichtingsdatum||'-')+'</td></tr>';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa"><strong>Rapportdatum</strong></td><td style="padding:8px;border:1px solid #ddd">'+new Date().toLocaleDateString('nl-NL')+'</td></tr>';
        h+='<tr><td style="padding:8px;border:1px solid #ddd;background:#f8f9fa"><strong>Onderzoeker</strong></td><td style="padding:8px;border:1px solid #ddd">'+LICENSE.USER+' ('+LICENSE.ORG+')</td></tr>';
        h+='</table>';
        h+='<h3 style="color:var(--primary);border-bottom:2px solid var(--primary);padding-bottom:5px;margin-top:30px">2. Advies</h3>';
        h+='<div style="padding:20px;background:'+(adv==='positief'?'#d1e7dd':adv==='negatief'?'#f8d7da':'#fff3cd')+';border-radius:8px;border-left:5px solid '+(adv==='positief'?'var(--success)':adv==='negatief'?'var(--danger)':'var(--warning)')+'">';
        h+='<p style="font-size:1.1rem;font-weight:600;margin-bottom:10px">'+(adv==='positief'?'POSITIEF':adv==='negatief'?'NEGATIEF':adv==='voorwaardelijk'?'VOORWAARDELIJK':'NADER ONDERZOEK')+'</p>';
        h+='<p>'+at[adv]+'</p></div>';
        if(fl.length>0){
            h+='<h3 style="color:var(--primary);border-bottom:2px solid var(--primary);padding-bottom:5px;margin-top:30px">3. Gedetecteerde Signalen ('+fl.length+')</h3>';
            h+='<p style="color:var(--gray);margin-bottom:15px">De volgende risico-indicatoren zijn geÃƒÂ¯dentificeerd tijdens het onderzoek:</p>';
            fl.forEach((f,i)=>{
                h+='<div style="padding:15px;background:#f8f9fa;margin-bottom:10px;border-radius:4px;border-left:4px solid '+(f.severity==='kritiek'?'var(--danger)':'var(--hoog)')+'">';
                h+='<p style="font-weight:600;margin-bottom:5px">'+(i+1)+'. '+f.id+': '+f.title+' <span style="background:'+(f.severity==='kritiek'?'var(--danger)':'var(--hoog)')+';color:white;padding:2px 8px;border-radius:4px;font-size:0.75rem">'+f.severity.toUpperCase()+'</span></p>';
                h+='<p style="font-size:0.9rem;margin-bottom:5px">'+f.desc+'</p>';
                if(f.entity)h+='<p style="font-size:0.85rem;color:var(--gray)"><i class="fas fa-building"></i> '+f.entity+'</p>';
                h+='</div>';
            });
        }
        if(document.getElementById('optIncludeBronnen')?.checked&&GraphDB.documents.length>0){
            h+='<h3 style="color:var(--primary);border-bottom:2px solid var(--primary);padding-bottom:5px;margin-top:30px">4. Geraadpleegde Bronnen</h3>';
            h+='<ul style="margin:15px 0;padding-left:20px">';
            GraphDB.documents.forEach(d=>{h+='<li style="margin-bottom:8px">'+d.name+' <span style="color:var(--gray)">('+d.type+', '+d.pages+' pag.)</span></li>';});
            h+='</ul>';
        }
        h+='<div style="margin-top:40px;padding-top:20px;border-top:2px solid #ddd;text-align:center">';
        h+='<p style="font-size:0.85rem;color:var(--gray)">Dit rapport is gegenereerd met ZorgAnalyst Pro v1.0.0</p>';
        h+='<p style="font-size:0.85rem;color:var(--gray)">Ã‚Â© 2025 Knowledge by Data B.V. - Alle rechten voorbehouden</p></div></div></div>';
        document.getElementById('rapportPreview').innerHTML=h;document.getElementById('rapportPreview').style.display='block';document.getElementById('rapportEmpty').style.display='none';document.getElementById('btnDownloadRapport').disabled=false;
        this.generated=true;ActivityLog.add('success','Rapport gegenereerd',t+' - '+adv);
    },
    downloadWord: function() {if(!this.generated)return;let c=document.getElementById('rapportPreview').innerText;let b=new Blob([c],{type:'application/msword'});let a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='ZorgAnalyst_Rapport_'+Dossier.currentCode+'_'+new Date().toISOString().split('T')[0]+'.doc';a.click();ActivityLog.add('action','Rapport gedownload','Word');}
};

// ============================================================================
// OVERVIEW - RISK SCORE
// ============================================================================
const Overview = {
    recalculateScore: function() {
        let fl=App.redFlags;let sc={zorg:0,toezicht:0,financieel:0,structuur:0,documentatie:0};
        let wt={zorg:0.30,toezicht:0.15,financieel:0.25,structuur:0.20,documentatie:0.10};
        let sv={kritiek:30,hoog:20,gemiddeld:10};
        fl.forEach(f=>{let ca=f.category||'zorg';let s=sv[f.severity]||10;if(sc[ca]!==undefined)sc[ca]+=s;});
        Object.keys(sc).forEach(k=>{sc[k]=Math.min(100,sc[k]);});
        let tot=0;Object.keys(sc).forEach(k=>{tot+=sc[k]*wt[k];});tot=Math.round(tot);
        document.getElementById('riskScore').textContent=tot;
        document.getElementById('catZorg').textContent=sc.zorg;
        document.getElementById('catFinancieel').textContent=sc.financieel;
        document.getElementById('catStructuur').textContent=sc.structuur;
        document.getElementById('catToezicht').textContent=sc.toezicht;
        ['Zorg','Financieel','Structuur','Toezicht'].forEach(ca=>{
            let bar=document.getElementById('bar'+ca);let v=sc[ca.toLowerCase()];
            if(bar){bar.style.width=v+'%';bar.className='fill '+(v>60?'kritiek':v>30?'hoog':v>10?'gemiddeld':'laag');}
            let cat=document.getElementById('cat'+ca);
            if(cat)cat.style.color=v>60?'var(--danger)':v>30?'var(--hoog)':v>10?'var(--warning)':'var(--success)';
        });
        let se=document.getElementById('riskScore'),le=document.getElementById('riskLabel'),de=document.getElementById('riskScoreDisplay');
        if(tot>60){se.style.color='var(--danger)';le.style.color='var(--danger)';le.textContent='Hoog Risico';de.style.background='conic-gradient(var(--danger) '+(tot*3.6)+'deg, #e9ecef '+(tot*3.6)+'deg)';}
        else if(tot>30){se.style.color='var(--warning)';le.style.color='var(--warning)';le.textContent='Gemiddeld Risico';de.style.background='conic-gradient(var(--warning) '+(tot*3.6)+'deg, #e9ecef '+(tot*3.6)+'deg)';}
        else{se.style.color='var(--success)';le.style.color='var(--success)';le.textContent='Laag Risico';de.style.background='conic-gradient(var(--success) '+(tot*3.6)+'deg, #e9ecef '+(tot*3.6)+'deg)';}
        ActivityLog.add('action','Risicoscore herberekend','Score: '+tot);
    }
};

// ============================================================================
// DOSSIER MANAGEMENT
// ============================================================================
const Dossier = {
    currentCode:'ZA-2025-0847',
    save: function() {
        let d={version:'1.0.0-DEMO',savedAt:new Date().toISOString(),code:this.currentCode,graphDB:{companies:GraphDB.companies,persons:GraphDB.persons,relations:GraphDB.relations,documents:GraphDB.documents},redFlags:App.redFlags,financials:App.financials,uploadedFiles:App.uploadedFiles,activityLog:ActivityLog.entries};
        let b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});let a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='ZorgAnalyst_Dossier_'+this.currentCode+'_'+new Date().toISOString().split('T')[0]+'.json';a.click();
        ActivityLog.add('success','Dossier opgeslagen',this.currentCode);
    },
    load: function() {
        let i=document.createElement('input');i.type='file';i.accept='.json';
        i.onchange=(e)=>{let f=e.target.files[0];let r=new FileReader();
            r.onload=(evt)=>{try{
                let d=JSON.parse(evt.target.result);
                if(d.graphDB){GraphDB.companies=d.graphDB.companies||[];GraphDB.persons=d.graphDB.persons||[];GraphDB.relations=d.graphDB.relations||[];GraphDB.documents=d.graphDB.documents||[];}
                App.redFlags=d.redFlags||[];App.financials=d.financials||{};App.uploadedFiles=d.uploadedFiles||[];ActivityLog.entries=d.activityLog||[];this.currentCode=d.code;
                App.updateStats();App.renderUploadedFiles();ActivityLog.render();RedFlagsManager.render();Timeline.render();
                document.getElementById('dossierCode').textContent=this.currentCode||'Geladen';
                ActivityLog.add('success','Dossier geladen',f.name);
            }catch(err){alert('Kon niet laden: '+err.message);}};r.readAsText(f);
        };i.click();
    },
    exportJSON: function(){this.save();}
};

// ============================================================================
// ONDERZOEK INIT
// ============================================================================
const OnderzoekInit = {
    showDialog: function() {
        let h='<div style="position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;display:flex;align-items:center;justify-content:center"><div style="background:white;padding:30px;border-radius:16px;max-width:500px;width:90%">';
        h+='<h3 style="margin-bottom:20px;color:var(--primary)"><i class="fas fa-folder-plus"></i> Nieuw Onderzoek</h3>';
        h+='<div style="margin-bottom:15px"><label style="display:block;margin-bottom:5px;font-weight:600">Zorgaanbieder</label><input type="text" id="newZorgaanbieder" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px" placeholder="Naam zorgaanbieder"></div>';
        h+='<div style="margin-bottom:15px"><label style="display:block;margin-bottom:5px;font-weight:600">Type</label><select id="newOnderzoekType" style="width:100%;padding:12px;border:1px solid #ddd;border-radius:8px"><option value="wmo">Wmo-toezicht</option><option value="pgb">PGB-controle</option><option value="jeugd">Jeugdzorg</option><option value="integriteit">Integriteitsonderzoek</option></select></div>';
        h+='<div style="display:flex;gap:10px;justify-content:flex-end"><button onclick="this.closest(\'div[style*=position:fixed]\').remove()" style="padding:12px 24px;border:1px solid #ddd;border-radius:8px;background:white;cursor:pointer">Annuleren</button>';
        h+='<button onclick="OnderzoekInit.create()" style="padding:12px 24px;border:none;border-radius:8px;background:var(--accent);color:white;cursor:pointer;font-weight:600">Start</button></div></div></div>';
        let o=document.createElement('div');o.innerHTML=h;document.body.appendChild(o.firstElementChild);
    },
    create: function() {
        let n=document.getElementById('newZorgaanbieder').value.trim();let t=document.getElementById('newOnderzoekType').value;
        if(!n){alert('Vul naam in');return;}
        GraphDB.companies=[];GraphDB.persons=[];GraphDB.relations=[];GraphDB.documents=[];App.redFlags=[];App.uploadedFiles=[];App.financials={};ActivityLog.entries=[];
        let c='ZA-'+new Date().getFullYear()+'-'+String(Math.floor(Math.random()*9999)).padStart(4,'0');Dossier.currentCode=c;
        GraphDB.addCompany({name:n,kvk:'-',rechtsvorm:'-',source:'handmatig',isHoofd:true});
        document.getElementById('dossierCode').textContent=c;
        document.getElementById('dossierMeta').textContent=t+' | '+n+' | '+new Date().toLocaleDateString('nl-NL');
        App.updateStats();App.renderUploadedFiles();ActivityLog.add('success','Nieuw onderzoek',n);ActivityLog.render();
        document.querySelector('div[style*="position:fixed"]')?.remove();
    }
};

// ============================================================================
// PDF HANDLER & DECLARATIE ANALYSE (Simplified for demo)
// ============================================================================
const PDFHandler = {
    handleUpload: async function(i,t) {
        if(!i.files||!i.files[0])return;let f=i.files[0];
        if(App.isDuplicateFile(f.name)){alert('Document al geÃƒÂ¼pload');i.value='';return;}
        ActivityLog.add('action','Document upload',f.name+' ('+t+')');
        GraphDB.addDocument({name:f.name,type:t,date:new Date().toISOString(),pages:'?'});
        App.addUploadedFile(f.name,t);
        ActivityLog.add('success','Document verwerkt',f.name);
        i.value='';
    }
};

const DeclaratieAnalyse = {
    handleUpload: async function(i) {
        if(!i.files)return;
        for(let f of i.files){
            if(App.isDuplicateFile(f.name))continue;
            ActivityLog.add('action','Declaratie upload',f.name);
            GraphDB.addDocument({name:f.name,type:'declaratie',date:new Date().toISOString()});
            App.addUploadedFile(f.name,'declaratie');
        }
        i.value='';
    }
};

// ============================================================================
// INITIALIZATION
// ============================================================================
document.addEventListener('DOMContentLoaded',function(){
    if(typeof QRCode!=='undefined'&&document.getElementById('qrcode')){
        new QRCode(document.getElementById('qrcode'),{text:'ZorgAnalyst Pro DEMO | '+LICENSE.ORG,width:128,height:128});
    }
    if(typeof pdfjsLib!=='undefined'){
        pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
});

// Service Worker Registration
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('./sw.js')
            .then(function(reg) { console.log('SW registered'); })
            .catch(function(err) { console.error('SW error:', err); });
    });
}

console.log('%c ZorgAnalyst Pro v1.0.0 DEMO','font-size:16px;font-weight:bold;color:#0d6efd');
console.log('%c Demo data: Zorggroep Horizon B.V.','font-size:12px;color:#6f42c1');
console.log('%c 43 indicatoren | 8 signalen | 4 bedrijven | 7 personen','font-size:12px;color:#20c997');
</script>
</body>
</html>
