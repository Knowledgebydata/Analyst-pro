<!DOCTYPE html>
<!--
================================================================================
Uren Registratie Pro - Uitgebreide Urenregistratie
Versie: 2.0.0 PWA | Knowledge by Data
================================================================================
Copyright (c) 2025 L.P. Antenbrink, Knowledge by Data. Alle rechten voorbehouden.
================================================================================
-->
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#3f51b5">
<title>Uren Registratie Pro</title>
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./icons/icon-192x192.png">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
:root {
    --primary: #3f51b5;
    --primary-dark: #303f9f;
    --primary-light: #7986cb;
    --accent: #ff5722;
    --success: #4caf50;
    --warning: #ff9800;
    --danger: #f44336;
    --dark: #1a1a2e;
    --light: #f5f5f5;
    --gray: #757575;
    --gray-light: #e0e0e0;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--light);
    min-height: 100vh;
    color: var(--dark);
}

.hidden { display: none !important; }

/* Auth Screen */
.auth-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--dark), #16213e);
    padding: 20px;
}

.auth-box {
    background: rgba(255,255,255,0.05);
    padding: 40px;
    border-radius: 20px;
    width: 100%;
    max-width: 400px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    text-align: center;
}

.auth-box h1 { color: var(--primary-light); font-size: 1.8rem; margin-bottom: 10px; }
.auth-box p { color: var(--gray); margin-bottom: 30px; }

.auth-box input {
    width: 100%;
    padding: 15px;
    margin-bottom: 15px;
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    background: rgba(0,0,0,0.3);
    color: white;
    font-size: 1rem;
    text-align: center;
}

.auth-box input::placeholder { color: var(--gray); }
.auth-box input:focus { outline: none; border-color: var(--primary); }

.auth-box button {
    width: 100%;
    padding: 15px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
}

.auth-error { color: var(--danger); font-size: 0.85rem; margin-top: 10px; }

/* App */
.app-container { display: none; }
.app-container.active { display: block; }

.security-bar {
    background: var(--primary);
    color: white;
    padding: 8px 15px;
    font-size: 0.75rem;
    text-align: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
}

.app-header {
    background: linear-gradient(135deg, var(--dark), #16213e);
    color: white;
    padding: 20px;
    padding-top: 45px;
    text-align: center;
}

.app-header h1 { font-size: 1.3rem; color: var(--primary-light); margin-bottom: 5px; }
.app-header .user-name { color: var(--gray); font-size: 0.85rem; }

.nav-tabs {
    display: flex;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    position: sticky;
    top: 30px;
    z-index: 100;
}

.nav-tab {
    flex: 1;
    padding: 12px 8px;
    text-align: center;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 0.75rem;
    color: var(--gray);
    border-bottom: 3px solid transparent;
}

.nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
.nav-tab i { display: block; font-size: 1.1rem; margin-bottom: 3px; }

.main-content { padding: 15px; padding-bottom: 100px; }

.tab-content { display: none; }
.tab-content.active { display: block; }

.card {
    background: white;
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--gray-light);
}

.card-title { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 8px; }
.card-title i { color: var(--primary); }

.stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }

.stat-card {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    padding: 15px;
    border-radius: 12px;
    text-align: center;
}

.stat-card.accent { background: linear-gradient(135deg, var(--accent), #e64a19); }
.stat-card.success { background: linear-gradient(135deg, var(--success), #388e3c); }
.stat-card.neutral { background: linear-gradient(135deg, #607d8b, #455a64); }

.stat-number { font-size: 1.5rem; font-weight: bold; }
.stat-label { font-size: 0.7rem; opacity: 0.9; }

.form-group { margin-bottom: 15px; }
.form-label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; }

.form-control {
    width: 100%;
    padding: 12px;
    border: 2px solid var(--gray-light);
    border-radius: 10px;
    font-size: 1rem;
}

.form-control:focus { outline: none; border-color: var(--primary); }

.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

/* Category Grid */
.category-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }

.category-btn {
    padding: 14px 10px;
    border: 2px solid var(--gray-light);
    border-radius: 12px;
    background: white;
    cursor: pointer;
    text-align: center;
    font-size: 0.85rem;
}

.category-btn i { display: block; font-size: 1.2rem; margin-bottom: 5px; color: var(--primary); }
.category-btn:hover { border-color: var(--primary); }
.category-btn.active { border-color: var(--primary); background: var(--primary); color: white; }
.category-btn.active i { color: white; }

.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    border: none;
}

.btn-primary { background: var(--primary); color: white; }
.btn-accent { background: var(--accent); color: white; }
.btn-danger { background: var(--danger); color: white; }
.btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
.btn-block { width: 100%; }
.btn-lg { padding: 15px 24px; font-size: 1rem; }

/* Entry List */
.entry-list { display: flex; flex-direction: column; gap: 10px; }

.entry-item {
    background: var(--light);
    border-radius: 12px;
    padding: 14px;
    border-left: 4px solid var(--primary);
}

.entry-item-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
.entry-item-category { font-weight: 600; font-size: 0.95rem; }

.entry-item-hours {
    background: var(--primary);
    color: white;
    padding: 3px 10px;
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: 600;
}

.entry-item-meta { font-size: 0.8rem; color: var(--gray); }

/* Toast */
.toast-container { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); z-index: 2000; }

.toast {
    background: var(--dark);
    color: white;
    padding: 12px 20px;
    border-radius: 10px;
    margin-top: 8px;
    animation: slideUp 0.3s ease;
}

.toast.success { background: var(--success); }
.toast.error { background: var(--danger); }

@keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.empty-state { text-align: center; padding: 40px 20px; color: var(--gray); }
.empty-state i { font-size: 3rem; margin-bottom: 15px; opacity: 0.3; }
</style>
</head>
<body>

<!-- Auth Screen -->
<div class="auth-screen" id="auth-screen">
    <div class="auth-box">
        <h1><i class="fas fa-clock"></i> Uren Registratie Pro</h1>
        <p>Voer uw gegevens in om te starten</p>
        <input type="text" id="auth-name" placeholder="Uw naam" autocomplete="name">
        <input type="password" id="auth-pin" placeholder="Pincode" maxlength="4" inputmode="numeric">
        <button onclick="authenticate()"><i class="fas fa-sign-in-alt"></i> Inloggen</button>
        <div class="auth-error" id="auth-error"></div>
        <p style="margin-top: 20px; font-size: 0.75rem; color: var(--gray);">Pincode: 2024</p>
    </div>
</div>

<!-- App Container -->
<div class="app-container" id="app-container">
    <div class="security-bar"><i class="fas fa-lock"></i> Urenregistratie - Data blijft lokaal</div>

    <header class="app-header">
        <h1><i class="fas fa-clock"></i> Uren Registratie Pro</h1>
        <p class="user-name">Medewerker: <span id="display-user-name">-</span></p>
    </header>

    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard"><i class="fas fa-home"></i> Dashboard</button>
        <button class="nav-tab" data-tab="register"><i class="fas fa-plus"></i> Registreer</button>
        <button class="nav-tab" data-tab="overview"><i class="fas fa-list"></i> Overzicht</button>
        <button class="nav-tab" data-tab="export"><i class="fas fa-download"></i> Export</button>
    </nav>

    <main class="main-content">
        <!-- Dashboard -->
        <div id="tab-dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-today">0:00</div>
                    <div class="stat-label">Vandaag</div>
                </div>
                <div class="stat-card accent">
                    <div class="stat-number" id="stat-week">0:00</div>
                    <div class="stat-label">Deze week</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-number" id="stat-month">0:00</div>
                    <div class="stat-label">Deze maand</div>
                </div>
                <div class="stat-card neutral">
                    <div class="stat-number" id="stat-entries">0</div>
                    <div class="stat-label">Registraties</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-history"></i> Recente registraties</span>
                </div>
                <div id="recent-entries" class="entry-list"></div>
            </div>

            <button class="btn btn-primary btn-block btn-lg" onclick="switchTab('register')">
                <i class="fas fa-plus"></i> Uren Registreren
            </button>
        </div>

        <!-- Register Tab -->
        <div id="tab-register" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-tags"></i> Categorie</span>
                </div>
                <div class="category-grid" id="category-grid">
                    <button class="category-btn active" data-category="reistijd"><i class="fas fa-car"></i>Reistijd</button>
                    <button class="category-btn" data-category="demonstratie"><i class="fas fa-desktop"></i>Demonstratie</button>
                    <button class="category-btn" data-category="instructie"><i class="fas fa-chalkboard-teacher"></i>Instructie</button>
                    <button class="category-btn" data-category="programmeren"><i class="fas fa-code"></i>Programmeren</button>
                    <button class="category-btn" data-category="consultatie"><i class="fas fa-comments"></i>Consultatie</button>
                    <button class="category-btn" data-category="verkoop"><i class="fas fa-handshake"></i>Verkoop</button>
                    <button class="category-btn" data-category="overig"><i class="fas fa-ellipsis-h"></i>Overig</button>
                    <button class="category-btn" data-category="custom"><i class="fas fa-edit"></i>Eigen...</button>
                </div>
                <div class="form-group" id="custom-category-group" style="display: none;">
                    <input type="text" id="custom-category" class="form-control" placeholder="Eigen categorie...">
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-clock"></i> Details</span>
                </div>

                <div class="form-group">
                    <label class="form-label">Datum</label>
                    <input type="date" id="entry-date" class="form-control">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Starttijd</label>
                        <input type="time" id="entry-start" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Eindtijd</label>
                        <input type="time" id="entry-end" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Of: Aantal uren</label>
                    <input type="number" id="entry-hours" class="form-control" placeholder="Bijv. 2.5" step="0.25" min="0">
                </div>

                <div class="form-group">
                    <label class="form-label">Project / Klant</label>
                    <input type="text" id="entry-project" class="form-control" placeholder="Bijv. Gemeente Rotterdam">
                </div>

                <div class="form-group">
                    <label class="form-label">Omschrijving</label>
                    <textarea id="entry-description" class="form-control" rows="2" placeholder="Wat heb je gedaan?"></textarea>
                </div>

                <button class="btn btn-primary btn-block btn-lg" onclick="saveEntry()">
                    <i class="fas fa-save"></i> Opslaan
                </button>
            </div>
        </div>

        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-list"></i> Alle Registraties</span>
                    <span id="entry-count">0</span>
                </div>
                <div id="all-entries" class="entry-list"></div>
            </div>
        </div>

        <!-- Export Tab -->
        <div id="tab-export" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-download"></i> Exporteren</span>
                </div>
                <p style="color: var(--gray); margin-bottom: 20px; font-size: 0.9rem;">
                    Exporteer alle uren als JSON bestand voor Knowledge by Data administratie.
                </p>
                <button class="btn btn-primary btn-block btn-lg" onclick="exportJSON()">
                    <i class="fas fa-file-code"></i> Exporteer JSON
                </button>
                <button class="btn btn-outline btn-block" onclick="exportCSV()" style="margin-top: 10px;">
                    <i class="fas fa-file-csv"></i> Exporteer CSV
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title"><i class="fas fa-user"></i> Sessie</span>
                </div>
                <button class="btn btn-danger btn-block" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Uitloggen
                </button>
            </div>
        </div>
    </main>
</div>

<div class="toast-container" id="toast-container"></div>

<script>
'use strict';

const VALID_PIN = '2024';

const CATEGORY_LABELS = {
    'reistijd': 'Reistijd',
    'demonstratie': 'Demonstratie',
    'instructie': 'Instructie',
    'programmeren': 'Programmeren',
    'consultatie': 'Consultatie',
    'verkoop': 'Verkoop',
    'overig': 'Overig'
};

const APP_STATE = {
    user: null,
    entries: [],
    selectedCategory: 'reistijd'
};

// Auth
function authenticate() {
    const name = document.getElementById('auth-name').value.trim();
    const pin = document.getElementById('auth-pin').value;
    const errorEl = document.getElementById('auth-error');
    
    if (!name) { errorEl.textContent = 'Voer uw naam in'; return; }
    if (pin !== VALID_PIN) { errorEl.textContent = 'Ongeldige pincode'; return; }
    
    APP_STATE.user = name;
    localStorage.setItem('uren_user', name);
    loadData();
    showApp();
}

function showApp() {
    document.getElementById('auth-screen').classList.add('hidden');
    document.getElementById('app-container').classList.add('active');
    document.getElementById('display-user-name').textContent = APP_STATE.user;
    updateUI();
}

function logout() {
    if (!confirm('Weet u zeker dat u wilt uitloggen?')) return;
    localStorage.removeItem('uren_user');
    location.reload();
}

function checkSession() {
    const savedUser = localStorage.getItem('uren_user');
    if (savedUser) {
        APP_STATE.user = savedUser;
        loadData();
        showApp();
    }
}

// Data
function loadData() {
    const data = localStorage.getItem('uren_entries_' + APP_STATE.user);
    APP_STATE.entries = data ? JSON.parse(data) : [];
}

function saveData() {
    localStorage.setItem('uren_entries_' + APP_STATE.user, JSON.stringify(APP_STATE.entries));
}

// Tabs
document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
});

function switchTab(tabId) {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabId));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.toggle('active', c.id === 'tab-' + tabId));
    
    if (tabId === 'register') {
        document.getElementById('entry-date').value = new Date().toISOString().split('T')[0];
    }
}

// Category Selection
document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        APP_STATE.selectedCategory = btn.dataset.category;
        document.getElementById('custom-category-group').style.display = 
            btn.dataset.category === 'custom' ? 'block' : 'none';
    });
});

// Save Entry
function saveEntry() {
    const date = document.getElementById('entry-date').value;
    const startTime = document.getElementById('entry-start').value;
    const endTime = document.getElementById('entry-end').value;
    const manualHours = parseFloat(document.getElementById('entry-hours').value);
    const project = document.getElementById('entry-project').value.trim();
    const description = document.getElementById('entry-description').value.trim();
    
    let category = APP_STATE.selectedCategory;
    if (category === 'custom') {
        category = document.getElementById('custom-category').value.trim();
        if (!category) { showToast('Voer een categorie in', 'error'); return; }
    }
    
    if (!date) { showToast('Selecteer een datum', 'error'); return; }
    
    let hours = 0;
    if (startTime && endTime) {
        const start = new Date(`${date}T${startTime}`);
        const end = new Date(`${date}T${endTime}`);
        hours = (end - start) / (1000 * 60 * 60);
        if (hours <= 0) { showToast('Eindtijd moet na starttijd zijn', 'error'); return; }
    } else if (manualHours && manualHours > 0) {
        hours = manualHours;
    } else {
        showToast('Voer start/eindtijd of aantal uren in', 'error');
        return;
    }
    
    const entry = {
        id: Date.now().toString(36),
        date,
        startTime: startTime || null,
        endTime: endTime || null,
        hours: Math.round(hours * 100) / 100,
        category,
        project,
        description,
        createdAt: new Date().toISOString()
    };
    
    APP_STATE.entries.unshift(entry);
    saveData();
    updateUI();
    
    // Reset
    document.getElementById('entry-start').value = '';
    document.getElementById('entry-end').value = '';
    document.getElementById('entry-hours').value = '';
    document.getElementById('entry-project').value = '';
    document.getElementById('entry-description').value = '';
    
    showToast(`${formatHours(hours)} geregistreerd`, 'success');
    switchTab('dashboard');
}

// UI Updates
function updateUI() {
    updateStats();
    updateRecentEntries();
    updateAllEntries();
}

function updateStats() {
    const today = new Date().toISOString().split('T')[0];
    const weekStart = getWeekStart(new Date()).toISOString().split('T')[0];
    const monthStart = new Date().toISOString().slice(0, 7);
    
    const todayHours = APP_STATE.entries.filter(e => e.date === today).reduce((s, e) => s + e.hours, 0);
    const weekHours = APP_STATE.entries.filter(e => e.date >= weekStart).reduce((s, e) => s + e.hours, 0);
    const monthHours = APP_STATE.entries.filter(e => e.date.startsWith(monthStart)).reduce((s, e) => s + e.hours, 0);
    
    document.getElementById('stat-today').textContent = formatHours(todayHours);
    document.getElementById('stat-week').textContent = formatHours(weekHours);
    document.getElementById('stat-month').textContent = formatHours(monthHours);
    document.getElementById('stat-entries').textContent = APP_STATE.entries.length;
}

function updateRecentEntries() {
    const container = document.getElementById('recent-entries');
    const recent = APP_STATE.entries.slice(0, 5);
    
    if (recent.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-clock"></i><p>Nog geen registraties</p></div>';
        return;
    }
    
    container.innerHTML = recent.map(e => renderEntry(e)).join('');
}

function updateAllEntries() {
    const container = document.getElementById('all-entries');
    document.getElementById('entry-count').textContent = APP_STATE.entries.length;
    
    if (APP_STATE.entries.length === 0) {
        container.innerHTML = '<div class="empty-state"><i class="fas fa-clock"></i><p>Nog geen registraties</p></div>';
        return;
    }
    
    container.innerHTML = APP_STATE.entries.map(e => renderEntry(e)).join('');
}

function renderEntry(e) {
    const categoryLabel = CATEGORY_LABELS[e.category] || e.category;
    const date = new Date(e.date).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
    return `
        <div class="entry-item">
            <div class="entry-item-header">
                <span class="entry-item-category">${escapeHtml(categoryLabel)}</span>
                <span class="entry-item-hours">${formatHours(e.hours)}</span>
            </div>
            <div class="entry-item-meta">
                <span><i class="fas fa-calendar"></i> ${date}</span>
                ${e.project ? ` | ${escapeHtml(e.project)}` : ''}
            </div>
        </div>
    `;
}

// Export
function exportJSON() {
    if (APP_STATE.entries.length === 0) { showToast('Geen data om te exporteren', 'error'); return; }
    
    const totalHours = APP_STATE.entries.reduce((s, e) => s + e.hours, 0);
    
    const exportData = {
        type: 'uren_registratie',
        version: '2.0.0',
        medewerker: APP_STATE.user,
        exportDatum: new Date().toISOString(),
        periode: {
            van: APP_STATE.entries[APP_STATE.entries.length - 1].date,
            tot: APP_STATE.entries[0].date
        },
        totalen: {
            aantalRegistraties: APP_STATE.entries.length,
            totaalUren: Math.round(totalHours * 100) / 100
        },
        registraties: APP_STATE.entries
    };
    
    const filename = `uren_registratie_${APP_STATE.user.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
    downloadFile(JSON.stringify(exportData, null, 2), filename, 'application/json');
    showToast('JSON geëxporteerd', 'success');
}

function exportCSV() {
    if (APP_STATE.entries.length === 0) { showToast('Geen data om te exporteren', 'error'); return; }
    
    const headers = ['Medewerker', 'Datum', 'Categorie', 'Uren', 'Project', 'Omschrijving'];
    const rows = APP_STATE.entries.map(e => [
        APP_STATE.user,
        e.date,
        CATEGORY_LABELS[e.category] || e.category,
        e.hours.toString().replace('.', ','),
        e.project || '',
        e.description || ''
    ]);
    
    const csv = [headers, ...rows].map(r => r.map(c => `"${String(c).replace(/"/g, '""')}"`).join(';')).join('\n');
    const filename = `uren_registratie_${APP_STATE.user.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`;
    downloadFile('\uFEFF' + csv, filename, 'text/csv;charset=utf-8');
    showToast('CSV geëxporteerd', 'success');
}

// Utils
function formatHours(h) {
    const hours = Math.floor(h);
    const mins = Math.round((h - hours) * 60);
    return `${hours}:${mins.toString().padStart(2, '0')}`;
}

function getWeekStart(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    d.setDate(diff);
    d.setHours(0, 0, 0, 0);
    return d;
}

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// Init
document.addEventListener('DOMContentLoaded', checkSession);

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(err => console.error('SW:', err));
}
</script>
</body>
</html>
